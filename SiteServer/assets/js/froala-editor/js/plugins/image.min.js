!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Object.assign(e.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1}),e.PLUGINS.image=function(a){var i,r,n,s,o,l,f=a.$,p="https://i.froala.com/upload",g=!1,d=1,c=2,m=3,u=4,h=5,v=6,b={};function y(){var e=a.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),i&&e.val(i.attr("src")),e.trigger("change")}function w(){var e=a.popups.get("image.edit");if(e||(e=O()),e){var t=we();Ce()&&(t=t.find(".fr-img-wrap")),a.popups.setContainer("image.edit",a.$sc),a.popups.refresh("image.edit");var r=t.offset().left+t.outerWidth()/2,n=t.offset().top+t.outerHeight();i.hasClass("fr-uploading")?k():a.popups.show("image.edit",r,n,t.outerHeight(),!0)}}function C(){N()}function A(e){0<e.parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first());var t=e.hasClass("fr-dib")?"block":e.hasClass("fr-dii")?"inline":null,a=e.hasClass("fr-fil")?"left":e.hasClass("fr-fir")?"right":ue(e);me(e,t,a),e.removeClass("fr-dib fr-dii fr-fir fr-fil")}function E(){for(var e,t="IMG"==a.el.tagName?[a.el]:a.el.querySelectorAll("img"),i=0;i<t.length;i++){var r=f(t[i]);!a.opts.htmlUntouched&&a.opts.useClasses?((a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&(0<(e=r).parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first()),e.hasClass("fr-dii")||e.hasClass("fr-dib")||(e.addClass("fr-fi"+ue(e)[0]),e.addClass("fr-di"+he(e)[0]),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align",""))),a.opts.imageTextNear||(0<r.parents(".fr-img-caption").length?r.parents(".fr-img-caption").first().removeClass("fr-dii").addClass("fr-dib"):r.removeClass("fr-dii").addClass("fr-dib"))):a.opts.htmlUntouched||a.opts.useClasses||(a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&A(r),a.opts.iframe&&r.on("load",a.size.syncIframe)}}function S(e){void 0===e&&(e=!0);var t,i=Array.prototype.slice.call(a.el.querySelectorAll("img")),r=[];for(t=0;t<i.length;t++)if(r.push(i[t].getAttribute("src")),f(i[t]).toggleClass("fr-draggable",a.opts.imageMove),""===i[t].getAttribute("class")&&i[t].removeAttribute("class"),""===i[t].getAttribute("style")&&i[t].removeAttribute("style"),i[t].parentNode&&i[t].parentNode.parentNode&&a.node.hasClass(i[t].parentNode.parentNode,"fr-img-caption")){var n=i[t].parentNode.parentNode;a.browser.mozilla||n.setAttribute("contenteditable",!1),n.setAttribute("draggable",!1),n.classList.add("fr-draggable");var s=i[t].nextSibling;s&&!a.browser.mozilla&&s.setAttribute("contenteditable",!0)}if(o)for(t=0;t<o.length;t++)r.indexOf(o[t].getAttribute("src"))<0&&a.events.trigger("image.removed",[f(o[t])]);if(o&&e){var l=[];for(t=0;t<o.length;t++)l.push(o[t].getAttribute("src"));for(t=0;t<i.length;t++)l.indexOf(i[t].getAttribute("src"))<0&&a.events.trigger("image.loaded",[f(i[t])])}o=i}function R(){if(r||function(){var t;if(a.shared.$image_resizer?(r=a.shared.$image_resizer,s=a.shared.$img_overlay,a.events.on("destroy",function(){f("body").first().append(r.removeClass("fr-active"))},!0)):(a.shared.$image_resizer=f(document.createElement("div")).attr("class","fr-image-resizer"),r=a.shared.$image_resizer,a.events.$on(r,"mousedown",function(e){e.stopPropagation()},!0),a.opts.imageResize&&(r.append(D("nw")+D("ne")+D("sw")+D("se")),a.shared.$img_overlay=f(document.createElement("div")).attr("class","fr-image-overlay"),s=a.shared.$img_overlay,t=r.get(0).ownerDocument,f(t).find("body").first().append(s))),a.events.on("shared.destroy",function(){r.html("").removeData().remove(),r=null,a.opts.imageResize&&(s.remove(),s=null)},!0),a.helpers.isMobile()||a.events.$on(f(a.o_win),"resize",function(){i&&!i.hasClass("fr-uploading")?pe(!0):i&&(R(),ve(),k(!1))}),a.opts.imageResize){t=r.get(0).ownerDocument,a.events.$on(r,a._mousedown,".fr-handler",$),a.events.$on(f(t),a._mousemove,U),a.events.$on(f(t.defaultView||t.parentWindow),a._mouseup,I),a.events.$on(s,"mouseleave",I);var n=1,o=null,l=0;a.events.on("keydown",function(t){if(i){var r=-1!=navigator.userAgent.indexOf("Mac OS X")?t.metaKey:t.ctrlKey,s=t.which;(s!==o||200<t.timeStamp-l)&&(n=1),(s==e.KEYCODE.EQUALS||a.browser.mozilla&&s==e.KEYCODE.FF_EQUALS)&&r&&!t.altKey?n=ee.call(this,t,1,1,n):(s==e.KEYCODE.HYPHEN||a.browser.mozilla&&s==e.KEYCODE.FF_HYPHEN)&&r&&!t.altKey?n=ee.call(this,t,2,-1,n):a.keys.ctrlKey(t)||s!=e.KEYCODE.ENTER||(i.before("<br>"),_(i)),o=s,l=t.timeStamp}},!0),a.events.on("keyup",function(){n=1})}}(),!i)return!1;var t=a.$wp||a.$sc;t.append(r),r.data("instance",a);var n=t.scrollTop()-("static"!=t.css("position")?t.offset().top:0),o=t.scrollLeft()-("static"!=t.css("position")?t.offset().left:0);o-=a.helpers.getPX(t.css("border-left-width")),n-=a.helpers.getPX(t.css("border-top-width")),a.$el.is("img")&&a.$sc.is("body")&&(o=n=0);var l=we();Ce()&&(l=l.find(".fr-img-wrap"));var p=0,g=0;a.opts.iframe&&(p=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),g=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"))),r.css("top",(a.opts.iframe?l.offset().top+p:l.offset().top+n)-1).css("left",(a.opts.iframe?l.offset().left+g:l.offset().left+o)-1).css("width",l.get(0).getBoundingClientRect().width).css("height",l.get(0).getBoundingClientRect().height).addClass("fr-active")}function D(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function x(e){Ce()?i.parents(".fr-img-caption").css("width",e):i.css("width",e)}function $(e){if(!a.core.sameInstance(r))return!0;if(e.preventDefault(),e.stopPropagation(),a.$el.find("img.fr-error").left)return!1;a.undo.canDo()||a.undo.saveStep();var t=e.pageX||e.originalEvent.touches[0].pageX;if("mousedown"==e.type){var o=a.$oel.get(0).ownerDocument,l=o.defaultView||o.parentWindow,p=!1;try{p=l.location!=l.parent.location&&!(l.$&&l.$.FE)}catch(e){}p&&l.frameElement&&(t+=a.helpers.getPX(f(l.frameElement).offset().left)+l.frameElement.clientLeft)}(n=f(this)).data("start-x",t),n.data("start-width",i.width()),n.data("start-height",i.height());var g=i.width();if(a.opts.imageResizeWithPercent){var d=i.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;g=(g/f(d).outerWidth()*100).toFixed(2)+"%"}x(g),s.show(),a.popups.hideAll(),ce()}function U(e){if(!a.core.sameInstance(r))return!0;var t;if(n&&i){if(e.preventDefault(),a.$el.find("img.fr-error").left)return!1;var s=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);if(!s)return!1;var o=s-n.data("start-x"),l=n.data("start-width");if((n.hasClass("fr-hnw")||n.hasClass("fr-hsw"))&&(o=0-o),a.opts.imageResizeWithPercent){var p=i.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;l=((l+o)/f(p).outerWidth()*100).toFixed(2),a.opts.imageRoundPercent&&(l=Math.round(l)),x(l+"%"),(t=Ce()?(a.helpers.getPX(i.parents(".fr-img-caption").css("width"))/f(p).outerWidth()*100).toFixed(2):(a.helpers.getPX(i.css("width"))/f(p).outerWidth()*100).toFixed(2))===l||a.opts.imageRoundPercent||x(t+"%"),i.css("height","").removeAttr("height")}else l+o>=a.opts.imageMinWidth&&(x(l+o),t=Ce()?a.helpers.getPX(i.parents(".fr-img-caption").css("width")):a.helpers.getPX(i.css("width"))),t!==l+o&&x(t),((i.attr("style")||"").match(/(^height:)|(; *height:)/)||i.attr("height"))&&(i.css("height",n.data("start-height")*i.width()/n.data("start-width")),i.removeAttr("height"));R(),a.events.trigger("image.resize",[ye()])}}function I(e){if(!a.core.sameInstance(r))return!0;if(n&&i){if(e&&e.stopPropagation(),a.$el.find("img.fr-error").left)return!1;n=null,s.hide(),R(),w(),a.undo.saveStep(),a.events.trigger("image.resizeEnd",[ye()])}}function P(e,t,r){a.edit.on(),i&&i.addClass("fr-error"),b[e]?T(b[e]):T(a.language.translate("Something went wrong. Please try again.")),!i&&r&&te(r),a.events.trigger("image.error",[{code:e,message:b[e]},t,r])}function O(e){if(e)return a.$wp&&a.events.$on(a.$wp,"scroll.image-edit",function(){i&&a.popups.isVisible("image.edit")&&(a.events.disableBlur(),w())}),!0;var t="";if(0<a.opts.imageEditButtons.length){var r={buttons:t+='<div class="fr-buttons"> \n        '.concat(a.button.buildList(a.opts.imageEditButtons),"\n        </div>")};return a.popups.create("image.edit",r)}return!1}function k(e){var t=a.popups.get("image.insert");if(t||(t=X()),t.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").addClass("fr-active"),t.find(".fr-buttons").hide(),i){var r=we();a.popups.setContainer("image.insert",a.$sc);var n=r.offset().left,s=r.offset().top+r.height();a.popups.show("image.insert",n,s,r.outerHeight())}void 0===e&&B(a.language.translate("Uploading"),0)}function N(e){var t=a.popups.get("image.insert");if(t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e||a.$el.find("img.fr-error").length)){if(a.events.focus(),a.$el.find("img.fr-error").length&&(a.$el.find("img.fr-error").remove(),a.undo.saveStep(),a.undo.run(),a.undo.dropRedo()),!a.$wp&&i){var r=i;pe(!0),a.selection.setAfter(r.get(0)),a.selection.restore()}a.popups.hide("image.insert")}}function B(e,t){var i=a.popups.get("image.insert");if(i){var r=i.find(".fr-image-progress-bar-layer");r.find("h3").text(e+(t?" "+t+"%":"")),r.removeClass("fr-error"),t?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width",t+"%")):r.find("div").addClass("fr-indeterminate")}}function T(e){k();var t=a.popups.get("image.insert").find(".fr-image-progress-bar-layer");t.addClass("fr-error");var i=t.find("h3");i.text(e),a.events.disableBlur(),i.focus()}function _(e){fe.call(e.get(0))}function L(){var e=f(this);a.popups.hide("image.insert"),e.removeClass("fr-uploading"),e.next().is("br")&&e.next().remove(),_(e),a.events.trigger("image.loaded",[e])}function M(e,t,i,r,n){a.edit.off(),B(a.language.translate("Loading image")),t&&(e=a.helpers.sanitizeURL(e));var s=new Image;s.onload=function(){var t,s;if(r){a.undo.canDo()||r.hasClass("fr-uploading")||a.undo.saveStep();var o=r.data("fr-old-src");r.data("fr-image-pasted")&&(o=null),a.$wp?((t=r.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),o&&r.attr("src",o),r.replaceWith(t)):t=r;for(var l=t.get(0).attributes,f=0;f<l.length;f++){var p=l[f];0===p.nodeName.indexOf("data-")&&t.removeAttr(p.nodeName)}if(void 0!==i)for(s in i)i.hasOwnProperty(s)&&"link"!=s&&t.attr("data-"+s,i[s]);t.on("load",L),t.attr("src",e),a.edit.on(),S(!1),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger(o?"image.replaced":"image.inserted",[t,n])}else t=Y(e,i,L),S(!1),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger("image.inserted",[t,n])},s.onerror=function(){P(d)},k(a.language.translate("Loading image")),s.src=e}function z(){P(u,this.response||this.responseText||this.responseXML)}function K(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;B(a.language.translate("Uploading"),t)}}function Y(e,t,i){var r,n=f(document.createElement("img")).attr("src",e);if(t&&void 0!==t)for(r in t)t.hasOwnProperty(r)&&"link"!=r&&(t[r],n.attr("data-str"+r,t[r]));var s=a.opts.imageDefaultWidth;s&&"auto"!=s&&(s=a.opts.imageResizeWithPercent?"100%":s+"px"),n.attr("style",s?"width: "+s+";":""),me(n,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign),n.on("load",i),n.on("error",i),a.edit.on(),a.events.focus(!0),a.selection.restore(),a.undo.saveStep(),a.opts.imageSplitHTML?a.markers.split():a.markers.insert(),a.html.wrap();var o=a.$el.find(".fr-marker");return o.length?(o.parent().is("hr")&&o.parent().after(o),a.node.isLastSibling(o)&&o.parent().hasClass("fr-deletable")&&o.insertAfter(o.parent()),o.replaceWith(n)):a.$el.append(n),a.selection.clear(),n}function W(){a.edit.on(),N(!0)}function G(e,t){if(void 0!==e&&0<e.length){if(!1===a.events.trigger("image.beforeUpload",[e,t]))return!1;var r,n=e[0];if((null===a.opts.imageUploadURL||a.opts.imageUploadURL==p)&&!a.opts.imageUploadToS3)return function(e,t){var i=new FileReader;i.onload=function(){var r=i.result;if(i.result.indexOf("svg+xml")<0){for(var n=atob(i.result.split(",")[1]),s=[],o=0;o<n.length;o++)s.push(n.charCodeAt(o));r=window.URL.createObjectURL(new Blob([new Uint8Array(s)],{type:e.type})),a.image.insert(r,!1,null,t)}},k(),i.readAsDataURL(e)}(n,t||i),!1;if(n.name||(n.name=(new Date).getTime()+"."+(n.type||"image/jpeg").replace(/image\//g,"")),n.size>a.opts.imageMaxSize)return P(h),!1;if(a.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))<0)return P(v),!1;if(a.drag_support.formdata&&(r=a.drag_support.formdata?new FormData:null),r){var s;if(!1!==a.opts.imageUploadToS3)for(s in r.append("key",a.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(n.name||"untitled")),r.append("success_action_status","201"),r.append("X-Requested-With","xhr"),r.append("Content-Type",n.type),a.opts.imageUploadToS3.params)a.opts.imageUploadToS3.params.hasOwnProperty(s)&&r.append(s,a.opts.imageUploadToS3.params[s]);for(s in a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(s)&&r.append(s,a.opts.imageUploadParams[s]);r.append(a.opts.imageUploadParam,n,n.name);var o=a.opts.imageUploadURL;a.opts.imageUploadToS3&&(o=a.opts.imageUploadToS3.uploadURL?a.opts.imageUploadToS3.uploadURL:"https://"+a.opts.imageUploadToS3.region+".amazonaws.com/"+a.opts.imageUploadToS3.bucket),function(e,t,i,r){function n(){var i=f(this);i.off("load"),i.addClass("fr-uploading"),i.next().is("br")&&i.next().remove(),a.placeholder.refresh(),_(i),R(),k(),a.edit.off(),e.onload=function(){(function(e){B(a.language.translate("Loading image"));var t=this.status,i=this.response,r=this.responseXML,n=this.responseText;try{if(a.opts.imageUploadToS3)if(201==t){var s=function(e){try{var t=f(e).find("Location").text(),i=f(e).find("Key").text();return!1===a.events.trigger("image.uploadedToS3",[t,i,e],!0)?(a.edit.on(),!1):t}catch(t){return P(u,e),!1}}(r);s&&M(s,!1,[],e,i||r)}else P(u,i||r,e);else if(200<=t&&t<300){var o=function(e){try{if(!1===a.events.trigger("image.uploaded",[e],!0))return a.edit.on(),!1;var t=JSON.parse(e);return t.link?t:(P(c,e),!1)}catch(t){return P(u,e),!1}}(n);o&&M(o.link,!1,o,e,i||n)}else P(m,i||n,e)}catch(t){P(u,i||n,e)}}).call(e,i)},e.onerror=z,e.upload.onprogress=K,e.onabort=W,f(i.off("abortUpload")).on("abortUpload",function(){4!=e.readyState&&(e.abort(),r?(r.attr("src",r.data("fr-old-src")),r.removeClass("fr-uploading")):i.remove(),pe(!0))}),e.send(t)}var s=new FileReader;s.onload=function(){var e=s.result;if(s.result.indexOf("svg+xml")<0){for(var t=atob(s.result.split(",")[1]),i=[],o=0;o<t.length;o++)i.push(t.charCodeAt(o));e=window.URL.createObjectURL(new Blob([new Uint8Array(i)],{type:"image/jpeg"}))}r?(r.get(0).addEventListener("load",n),r.on("error",function(){n(),f(this).off("error")}),a.edit.on(),a.undo.saveStep(),r.data("fr-old-src",r.attr("src")),r.attr("src",e)):Y(e,null,n)},s.readAsDataURL(i)}(a.core.getXHR(o,a.opts.imageUploadMethod),r,n,t||i)}}}function V(e){if(e.is("img")&&0<e.parents(".fr-img-caption").length)return e.parents(".fr-img-caption")}function H(t){var i=t.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var r=i.files[0];if(r&&r.type&&-1!==r.type.indexOf("image")&&0<=a.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))){if(!a.opts.imageUpload)return t.preventDefault(),t.stopPropagation(),!1;a.markers.remove(),a.markers.insertAtPoint(t.originalEvent),a.$el.find(".fr-marker").replaceWith(e.MARKERS),0===a.$el.find(".fr-marker").length&&a.selection.setAtEnd(a.el),a.popups.hideAll();var n=a.popups.get("image.insert");n||(n=X()),a.popups.setContainer("image.insert",a.$sc);var s=t.originalEvent.pageX,o=t.originalEvent.pageY;if(a.opts.iframe){var l=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),f=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"));o+=a.$iframe.offset().top+l,s+=a.$iframe.offset().left+f}return a.popups.show("image.insert",s,o),k(),0<=a.opts.imageAllowedTypes.indexOf(r.type.replace(/image\//g,""))?(pe(!0),G(i.files)):P(v),t.preventDefault(),t.stopPropagation(),!1}}}function X(e){if(e)return a.popups.onRefresh("image.insert",y),a.popups.onHide("image.insert",C),!0;var t,r,n="";a.opts.imageUpload||-1===a.opts.imageInsertButtons.indexOf("imageUpload")||a.opts.imageInsertButtons.splice(a.opts.imageInsertButtons.indexOf("imageUpload"),1);var s=a.button.buildList(a.opts.imageInsertButtons);""!==s&&(n='<div class="fr-buttons fr-tabs">'+s+"</div>");var o=a.opts.imageInsertButtons.indexOf("imageUpload"),l=a.opts.imageInsertButtons.indexOf("imageByURL"),p="";0<=o&&(t=" fr-active",0<=l&&l<o&&(t=""),p='<div class="fr-image-upload-layer'+t+' fr-layer" id="fr-image-upload-layer-'+a.id+'"><strong>'+a.language.translate("Drop image")+"</strong><br>("+a.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/'+a.opts.imageAllowedTypes.join(", image/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-'+a.id+'" role="button"></div></div>');var g="";0<=l&&(t=" fr-active",0<=o&&o<l&&(t=""),g='<div class="fr-image-by-url-layer'+t+' fr-layer" id="fr-image-by-url-layer-'+a.id+'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-'+a.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">'+a.language.translate("Insert")+"</button></div></div>");var d={buttons:n,upload_layer:p,by_url_layer:g,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};return 1<=a.opts.imageInsertButtons.length&&(r=a.popups.create("image.insert",d)),a.$wp&&a.events.$on(a.$wp,"scroll",function(){i&&a.popups.isVisible("image.insert")&&ve()}),function(e){a.events.$on(e,"dragover dragenter",".fr-image-upload-layer",function(){return f(this).addClass("fr-drop"),!1},!0),a.events.$on(e,"dragleave dragend",".fr-image-upload-layer",function(){return f(this).removeClass("fr-drop"),!1},!0),a.events.$on(e,"drop",".fr-image-upload-layer",function(t){t.preventDefault(),t.stopPropagation(),f(this).removeClass("fr-drop");var i=t.originalEvent.dataTransfer;if(i&&i.files){var r=e.data("instance")||a;r.events.disableBlur(),r.image.upload(i.files),r.events.enableBlur()}},!0),a.helpers.isIOS()&&a.events.$on(e,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){f(this).trigger("click")},!0),a.events.$on(e,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var t=e.data("instance")||a;t.events.disableBlur(),e.find("input:focus").blur(),t.events.enableBlur(),t.image.upload(this.files,i)}f(this).val("")},!0)}(r),r}function F(){i&&a.popups.get("image.alt").find("input").val(i.attr("alt")||"").trigger("change")}function j(){var e=a.popups.get("image.alt");e||(e=q()),N(),a.popups.refresh("image.alt"),a.popups.setContainer("image.alt",a.$sc);var t=we();Ce()&&(t=t.find(".fr-img-wrap"));var i=t.offset().left+t.outerWidth()/2,r=t.offset().top+t.outerHeight();a.popups.show("image.alt",i,r,t.outerHeight(),!0)}function q(e){if(e)return a.popups.onRefresh("image.alt",F),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'+a.button.buildList(a.opts.imageAltButtons)+"</div>",alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+a.id+'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-'+a.id+'" type="text" placeholder="'+a.language.translate("Alternative Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">'+a.language.translate("Update")+"</button></div></div>"},r=a.popups.create("image.alt",t);return a.$wp&&a.events.$on(a.$wp,"scroll.image-alt",function(){i&&a.popups.isVisible("image.alt")&&j()}),r}function Q(){var e=a.popups.get("image.size");if(i)if(Ce()){var t=i.parent();t.get(0).style.width||(t=i.parent().parent()),e.find('input[name="width"]').val(t.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(t.get(0).style.height).trigger("change")}else e.find('input[name="width"]').val(i.get(0).style.width).trigger("change"),e.find('input[name="height"]').val(i.get(0).style.height).trigger("change")}function J(){var e=a.popups.get("image.size");e||(e=Z()),N(),a.popups.refresh("image.size"),a.popups.setContainer("image.size",a.$sc);var t=we();Ce()&&(t=t.find(".fr-img-wrap"));var i=t.offset().left+t.outerWidth()/2,r=t.offset().top+t.outerHeight();a.popups.show("image.size",i,r,t.outerHeight(),!0)}function Z(e){if(e)return a.popups.onRefresh("image.size",Q),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'+a.button.buildList(a.opts.imageSizeButtons)+"</div>",size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+a.id+'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-'+a.id+'" type="text" name="width" placeholder="'+a.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height'+a.id+'" type="text" name="height" placeholder="'+a.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">'+a.language.translate("Update")+"</button></div></div>"},r=a.popups.create("image.size",t);return a.$wp&&a.events.$on(a.$wp,"scroll.image-size",function(){i&&a.popups.isVisible("image.size")&&J()}),r}function ee(e,t,a,i){return e.pageX=t,$.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),U.call(this,e),I.call(this,e),++i}function te(t){(t=t||we())&&!1!==a.events.trigger("image.beforeRemove",[t])&&(a.popups.hideAll(),be(),pe(!0),a.undo.canDo()||a.undo.saveStep(),t.get(0)==a.el?t.removeAttr("src"):(t.get(0).parentNode&&"A"==t.get(0).parentNode.tagName?(a.selection.setBefore(t.get(0).parentNode)||a.selection.setAfter(t.get(0).parentNode)||t.parent().after(e.MARKERS),f(t.get(0).parentNode).remove()):(a.selection.setBefore(t.get(0))||a.selection.setAfter(t.get(0))||t.after(e.MARKERS),t.remove()),a.html.fillEmptyBlocks(),a.selection.restore()),a.undo.saveStep())}function ae(t){var r=t.which;if(i&&(r==e.KEYCODE.BACKSPACE||r==e.KEYCODE.DELETE))return t.preventDefault(),t.stopPropagation(),te(),!1;if(i&&r==e.KEYCODE.ESC){var n=i;return pe(!0),a.selection.setAfter(n.get(0)),a.selection.restore(),t.preventDefault(),!1}if(!i||r!=e.KEYCODE.ARROW_LEFT&&r!=e.KEYCODE.ARROW_RIGHT)return i&&r===e.KEYCODE.TAB?(t.preventDefault(),t.stopPropagation(),pe(!0),!1):i&&r!=e.KEYCODE.F10&&!a.keys.isBrowserAction(t)?(t.preventDefault(),t.stopPropagation(),!1):void 0;var s=i.get(0);return pe(!0),r==e.KEYCODE.ARROW_LEFT?a.selection.setBefore(s):a.selection.setAfter(s),a.selection.restore(),t.preventDefault(),!1}function ie(e){if(e&&"IMG"==e.tagName){if(a.node.hasClass(e,"fr-uploading")||a.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):a.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable"),e.parentNode&&e.parentNode.parentNode&&a.node.hasClass(e.parentNode.parentNode,"fr-img-caption")){var t=e.parentNode.parentNode;t.removeAttribute("contenteditable"),t.removeAttribute("draggable"),t.classList.remove("fr-draggable");var i=e.nextSibling;i&&i.removeAttribute("contenteditable")}}else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var r=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),n=0;n<r.length;n++)ie(r[n])}function re(e){if(!1===a.events.trigger("image.beforePasteUpload",[e]))return!1;i=f(e),R(),w(),ve(),k(),i.on("load",function(){R(),f(a.popups.get("image.insert").get(0)).find("div.fr-active.fr-error").length<1&&k(),f(this).off("load")});for(var t=f(e).attr("src").split(","),r=atob(t[1]),n=[],s=0;s<r.length;s++)n.push(r.charCodeAt(s));G([new Blob([new Uint8Array(n)],{type:t[0].replace(/data\:/g,"").replace(/;base64/g,"")})],i)}function ne(){a.opts.imagePaste?a.$el.find("img[data-fr-image-pasted]").each(function(e,t){if(a.opts.imagePasteProcess){var i=a.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=a.opts.imageResizeWithPercent?"%":"px"),f(t).css("width",i).removeClass("fr-dii fr-dib fr-fir fr-fil"),me(f(t),a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign)}if(0===t.src.indexOf("data:"))re(t);else if(0===t.src.indexOf("blob:")||0===t.src.indexOf("http")&&a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){var e,i=a.o_doc.createElement("CANVAS"),r=i.getContext("2d");i.height=this.naturalHeight,i.width=this.naturalWidth,r.drawImage(this,0,0),setTimeout(function(){re(t)},0),e=2e3<this.naturalWidth||1500<this.naturalHeight?"jpeg":"png",t.src=i.toDataURL("image/"+e)},r.src=(0===t.src.indexOf("blob:")?"":a.opts.imageCORSProxy+"/")+t.src}else 0!==t.src.indexOf("http")||0===t.src.indexOf("https://mail.google.com/mail")?(a.selection.save(),f(t).remove(),a.selection.restore()):f(t).removeAttr("data-fr-image-pasted")}):a.$el.find("img[data-fr-image-pasted]").remove()}function se(e){var t=e.target.result,i=a.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=a.opts.imageResizeWithPercent?"%":"px"),a.undo.saveStep(),a.html.insert('<img data-fr-image-pasted="true" src="'+t+'"'+(i?' style="width: '+i+';"':"")+">");var r=a.$el.find('img[data-fr-image-pasted="true"]');r&&me(r,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign),a.events.trigger("paste.after")}function oe(e){if(e&&e.clipboardData&&e.clipboardData.items){var t=null;if(e.clipboardData.types&&-1!=[].indexOf.call(e.clipboardData.types,"text/rtf")||e.clipboardData.getData("text/rtf"))t=e.clipboardData.items[0].getAsFile();else for(var a=0;a<e.clipboardData.items.length&&!(t=e.clipboardData.items[a].getAsFile());a++);if(t)return function(e){var t=new FileReader;t.onload=se,t.readAsDataURL(e)}(t),!1}}function le(e){return e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function fe(t){if("false"==f(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(t&&"touchend"==t.type&&l)return!0;if(t&&a.edit.isDisabled())return t.stopPropagation(),t.preventDefault(),!1;for(var r=0;r<e.INSTANCES.length;r++)e.INSTANCES[r]!=a&&e.INSTANCES[r].events.trigger("image.hideResizer");a.toolbar.disable(),t&&(t.stopPropagation(),t.preventDefault()),a.helpers.isMobile()&&(a.events.disableBlur(),a.$el.blur(),a.events.enableBlur()),a.opts.iframe&&a.size.syncIframe(),i=f(this),be(),R(),w(),a.browser.msie?(a.popups.areVisible()&&a.events.disableBlur(),a.win.getSelection&&(a.win.getSelection().removeAllRanges(),a.win.getSelection().addRange(a.doc.createRange()))):a.selection.clear(),a.helpers.isIOS()&&(a.events.disableBlur(),a.$el.blur()),a.button.bulkRefresh(),a.events.trigger("video.hideResizer")}function pe(e){i&&(ge||!0===e)&&(a.toolbar.enable(),r.removeClass("fr-active"),a.popups.hide("image.edit"),i=null,ce(),n=null,s&&s.hide())}b[d]="Image cannot be loaded from the passed link.",b[c]="No link in upload response.",b[m]="Error during file upload.",b[u]="Parsing response failed.",b[h]="File is too large.",b[v]="Image file type is invalid.",b[7]="Files can be uploaded only to same domain in IE 8 and IE 9.";var ge=!(b[8]="Image file is corrupted.");function de(){ge=!0}function ce(){ge=!1}function me(e,t,i){!a.opts.htmlUntouched&&a.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),i&&e.addClass("fr-fi"+i[0]),t&&e.addClass("fr-di"+t[0])):"inline"==t?(e.css({display:"inline-block",verticalAlign:"bottom",margin:a.opts.imageDefaultMargin}),"center"==i?e.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - "+2*a.opts.imageDefaultMargin+"px)",textAlign:"center"}):"left"==i?e.css({float:"left",marginLeft:0,maxWidth:"calc(100% - "+a.opts.imageDefaultMargin+"px)",textAlign:"left"}):e.css({float:"right",marginRight:0,maxWidth:"calc(100% - "+a.opts.imageDefaultMargin+"px)",textAlign:"right"})):"block"==t&&(e.css({display:"block",float:"none",verticalAlign:"top",margin:a.opts.imageDefaultMargin+"px auto",textAlign:"center"}),"left"==i?e.css({marginLeft:0,textAlign:"left"}):"right"==i&&e.css({marginRight:0,textAlign:"right"}))}function ue(e){if(void 0===e&&(e=we()),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function he(e){void 0===e&&(e=we());var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function ve(){var e=a.popups.get("image.insert");e||(e=X()),a.popups.isVisible("image.insert")||(N(),a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$sc));var t=we();Ce()&&(t=t.find(".fr-img-wrap"));var i=t.offset().left+t.outerWidth()/2,r=t.offset().top+t.outerHeight();a.popups.show("image.insert",i,r,t.outerHeight(!0),!0)}function be(){if(i){a.events.disableBlur(),a.selection.clear();var e=a.doc.createRange();e.selectNode(i.get(0)),a.browser.msie&&e.collapse(!0),a.selection.get().addRange(e),a.events.enableBlur()}}function ye(){return i}function we(){return Ce()?i.parents(".fr-img-caption").first():i}function Ce(){return!!i&&0<i.parents(".fr-img-caption").length}return{_init:function(){var t;a.events.$on(a.$el,a._mousedown,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==f(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;a.helpers.isMobile()||a.selection.clear(),g=!0,a.popups.areVisible()&&a.events.disableBlur(),a.browser.msie&&(a.events.disableBlur(),a.$el.attr("contenteditable",!1)),a.draggable||"touchstart"==e.type||e.preventDefault(),e.stopPropagation()}),a.events.$on(a.$el,a._mousedown,".fr-img-caption .fr-inner",function(e){a.core.hasFocus()||a.events.focus(),e.stopPropagation()}),a.events.$on(a.$el,"paste",".fr-img-caption .fr-inner",function(e){a.toolbar.hide(),e.stopPropagation()}),a.events.$on(a.$el,a._mouseup,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==f(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;g&&(g=!1,e.stopPropagation(),a.browser.msie&&(a.$el.attr("contenteditable",!0),a.events.enableBlur()))}),a.events.on("keyup",function(e){if(e.shiftKey&&""===a.selection.text().replace(/\n/g,"")&&a.keys.isArrow(e.which)){var t=a.selection.element(),i=a.selection.endElement();t&&"IMG"==t.tagName?_(f(t)):i&&"IMG"==i.tagName&&_(f(i))}},!0),a.events.on("drop",H),a.events.on("element.beforeDrop",V),a.events.on("mousedown window.mousedown",de),a.events.on("window.touchmove",ce),a.events.on("mouseup window.mouseup",function(){if(i)return pe(),!1;ce()}),a.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&pe()}),a.events.on("image.resizeEnd",function(){a.opts.iframe&&a.size.syncIframe()}),a.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){pe(!(g=!1))}),a.events.on("modals.hide",function(){i&&(be(),a.selection.clear())}),a.events.on("image.resizeEnd",function(){a.win.getSelection&&_(i)}),a.opts.imageAddNewLine&&a.events.on("image.inserted",function(t){var i=t.get(0);for(i.nextSibling&&"BR"===i.nextSibling.tagName&&(i=i.nextSibling);i&&!a.node.isElement(i);)i=a.node.isLastSibling(i)?i.parentNode:null;a.node.isElement(i)&&(a.opts.enter===e.ENTER_BR?t.after("<br>"):f(a.node.blockParent(t.get(0))).after("<"+a.html.defaultTag()+"><br></"+a.html.defaultTag()+">"))}),"IMG"==a.el.tagName&&a.$el.addClass("fr-view"),a.events.$on(a.$el,a.helpers.isMobile()&&!a.helpers.isWindowsPhone()?"touchend":"click","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',fe),a.helpers.isMobile()&&(a.events.$on(a.$el,"touchstart","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(){l=!1}),a.events.$on(a.$el,"touchmove",function(){l=!0})),a.$wp?(a.events.on("window.keydown keydown",ae,!0),a.events.on("keyup",function(t){if(i&&t.which==e.KEYCODE.ENTER)return!1},!0),a.events.$on(a.$el,"keydown",function(){var t=a.selection.element();(t.nodeType===Node.TEXT_NODE||"BR"==t.tagName&&a.node.isLastSibling(t))&&(t=t.parentNode),a.node.hasClass(t,"fr-inner")||(a.node.hasClass(t,"fr-img-caption")||(t=f(t).parents(".fr-img-caption").get(0)),a.node.hasClass(t,"fr-img-caption")&&(f(t).after(e.INVISIBLE_SPACE+e.MARKERS),a.selection.restore()))})):a.events.$on(a.$win,"keydown",ae),a.events.on("toolbar.esc",function(){if(i){if(a.$wp)a.events.disableBlur(),a.events.focus();else{var e=i;pe(!0),a.selection.setAfter(e.get(0)),a.selection.restore()}return!1}},!0),a.events.on("toolbar.focusEditor",function(){if(i)return!1},!0),a.events.on("window.cut window.copy",function(t){if(i&&a.popups.isVisible("image.edit")&&!a.popups.get("image.edit").find(":focus").length){var r=we();Ce()?(r.before(e.START_MARKER),r.after(e.END_MARKER),a.selection.restore(),a.paste.saveCopiedText(r.get(0).outerHTML,r.text())):(be(),a.paste.saveCopiedText(i.get(0).outerHTML,i.attr("alt"))),"copy"==t.type?setTimeout(function(){_(i)}):(pe(!0),a.undo.saveStep(),setTimeout(function(){a.undo.saveStep()},0))}},!0),a.browser.msie&&a.events.on("keydown",function(t){if(!a.selection.isCollapsed()||!i)return!0;var r=t.which;r==e.KEYCODE.C&&a.keys.ctrlKey(t)?a.events.trigger("window.copy"):r==e.KEYCODE.X&&a.keys.ctrlKey(t)&&a.events.trigger("window.cut")}),a.events.$on(f(a.o_win),"keydown",function(t){var a=t.which;if(i&&a==e.KEYCODE.BACKSPACE)return t.preventDefault(),!1}),a.events.$on(a.$win,"keydown",function(t){var a=t.which;i&&i.hasClass("fr-uploading")&&a==e.KEYCODE.ESC&&i.trigger("abortUpload")}),a.events.on("destroy",function(){i&&i.hasClass("fr-uploading")&&i.trigger("abortUpload")}),a.events.on("paste.before",oe),a.events.on("paste.beforeCleanup",le),a.events.on("paste.after",ne),a.events.on("html.set",E),a.events.on("html.inserted",E),E(),a.events.on("destroy",function(){o=[]}),a.events.on("html.processGet",ie),a.opts.imageOutputSize&&a.events.on("html.beforeGet",function(){t=a.el.querySelectorAll("img");for(var e=0;e<t.length;e++){var i=t[e].style.width||f(t[e]).width(),r=t[e].style.height||f(t[e]).height();i&&t[e].setAttribute("width",(""+i).replace(/px/,"")),r&&t[e].setAttribute("height",(""+r).replace(/px/,""))}}),a.opts.iframe&&a.events.on("image.loaded",a.size.syncIframe),a.$wp&&(S(),a.events.on("contentChanged",S)),a.events.$on(f(a.o_win),"orientationchange.image",function(){setTimeout(function(){i&&_(i)},100)}),O(!0),X(!0),Z(!0),q(!0),a.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return te(e),!1})},showInsertPopup:function(){var e=a.$tb.find('.fr-command[data-cmd="insertImage"]'),t=a.popups.get("image.insert");if(t||(t=X()),N(),!t.hasClass("fr-active"))if(a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$tb),e.isVisible()){var i=a.button.getPosition(e),r=i.left,n=i.top;a.popups.show("image.insert",r,n,e.outerHeight())}else a.position.forSelection(t),a.popups.show("image.insert")},showLayer:function(e){var t,r,n=a.popups.get("image.insert");if(i||a.opts.toolbarInline){if(i){var s=we();Ce()&&(s=s.find(".fr-img-wrap")),r=s.offset().top+s.outerHeight(),t=s.offset().left}}else{var o=a.$tb.find('.fr-command[data-cmd="insertImage"]');t=o.offset().left,r=o.offset().top+(a.opts.toolbarBottom?10:o.outerHeight()-10)}!i&&a.opts.toolbarInline&&(r=n.offset().top-a.helpers.getPX(n.css("margin-top")),n.hasClass("fr-above")&&(r+=n.outerHeight())),n.find(".fr-layer").removeClass("fr-active"),n.find(".fr-"+e+"-layer").addClass("fr-active"),a.popups.show("image.insert",t,r,i?i.outerHeight():0),a.accessibility.focusPopup(n)},refreshUploadButton:function(e){var t=a.popups.get("image.insert");t&&t.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(e){var t=a.popups.get("image.insert");t&&t.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:G,insertByURL:function(){var e=a.popups.get("image.insert").find(".fr-image-by-url-layer input");if(0<e.val().length){k(),B(a.language.translate("Loading image"));var t=e.val().trim();if(a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy&&a.opts.imageUpload){var r=new XMLHttpRequest;r.onload=function(){200==this.status?G([new Blob([this.response],{type:this.response.type||"image/png"})],i):P(d)},r.onerror=function(){M(t,!0,[],i)},r.open("GET",a.opts.imageCORSProxy+"/"+t,!0),r.responseType="blob",r.send()}else M(t,!0,[],i);e.val(""),e.blur()}},align:function(e){var t=we();t.removeClass("fr-fir fr-fil"),!a.opts.htmlUntouched&&a.opts.useClasses?"left"==e?t.addClass("fr-fil"):"right"==e&&t.addClass("fr-fir"):me(t,he(),e),be(),R(),w(),a.selection.clear()},refreshAlign:function(e){i&&e.find("> *").first().replaceWith(a.icon.create("image-align-"+ue()))},refreshAlignOnShow:function(e,t){i&&t.find('.fr-command[data-param1="'+ue()+'"]').addClass("fr-active").attr("aria-selected",!0)},display:function(e){var t=we();t.removeClass("fr-dii fr-dib"),!a.opts.htmlUntouched&&a.opts.useClasses?"inline"==e?t.addClass("fr-dii"):"block"==e&&t.addClass("fr-dib"):me(t,e,ue()),be(),R(),w(),a.selection.clear()},refreshDisplayOnShow:function(e,t){i&&t.find('.fr-command[data-param1="'+he()+'"]').addClass("fr-active").attr("aria-selected",!0)},replace:ve,back:function(){i?(a.events.disableBlur(),f(".fr-popup input:focus").blur(),_(i)):(a.events.disableBlur(),a.selection.restore(),a.events.enableBlur(),a.popups.hide("image.insert"),a.toolbar.showInline())},get:ye,getEl:we,insert:M,showProgressBar:k,remove:te,hideProgressBar:N,applyStyle:function(e,r,n){if(void 0===r&&(r=a.opts.imageStyles),void 0===n&&(n=a.opts.imageMultipleStyles),!i)return!1;var s=we();if(!n){var o=Object.keys(r);o.splice(o.indexOf(e),1),s.removeClass(o.join(" "))}"object"==t(r[e])?(s.removeAttr("style"),s.css(r[e].style)):s.toggleClass(e),_(i)},showAltPopup:j,showSizePopup:J,setAlt:function(e){if(i){var t=a.popups.get("image.alt");i.attr("alt",e||t.find("input").val()||""),t.find("input:focus").blur(),_(i)}},setSize:function(e,t){if(i){var r=a.popups.get("image.size");e=e||r.find('input[name="width"]').val()||"",t=t||r.find('input[name="height"]').val()||"";var n=/^[\d]+((px)|%)*$/g;i.removeAttr("width").removeAttr("height"),e.match(n)?i.css("width",e):i.css("width",""),t.match(n)?i.css("height",t):i.css("height",""),Ce()&&(i.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),e.match(n)?i.parents(".fr-img-caption").css("width",e):i.parents(".fr-img-caption").css("width",""),t.match(n)?i.parents(".fr-img-caption").css("height",t):i.parents(".fr-img-caption").css("height","")),r&&r.find("input:focus").blur(),_(i)}},toggleCaption:function(){var t;if(i&&!Ce()){var r,n;(t=i).parent().is("a")&&(t=i.parent()),t.attr("style")&&(n=-1<(r=t.attr("style").split(":")).indexOf("width")?r[r.indexOf("width")+1].replace(";",""):"");var s=a.opts.imageResizeWithPercent?(-1<n.indexOf("px")?null:n)||"100%":i.width()+"px";t.wrap("<span "+(a.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+i.attr("class")+'" style="'+(a.opts.useClasses?"":t.attr("style"))+'" draggable="false"></span>'),t.wrap('<span class="fr-img-wrap"></span>'),i.after('<span class="fr-inner"'+(a.browser.mozilla?"":' contenteditable="true"')+">"+e.START_MARKER+a.language.translate("Image Caption")+e.END_MARKER+"</span>"),i.removeAttr("class").removeAttr("style").removeAttr("width"),i.parents(".fr-img-caption").css("width",s),pe(!0),a.selection.restore()}else t=we(),i.insertAfter(t),i.attr("class",t.attr("class").replace("fr-img-caption","")).attr("style",t.attr("style")),t.remove(),_(i)},hasCaption:Ce,exitEdit:pe,edit:_}},e.DefineIcon("insertImage",{NAME:"image",SVG_KEY:"insertImage"}),e.RegisterShortcut(e.KEYCODE.P,"insertImage",null,"P"),e.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.DefineIcon("imageUpload",{NAME:"upload",SVG_KEY:"upload"}),e.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.DefineIcon("imageByURL",{NAME:"link",SVG_KEY:"insertLink"}),e.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.DefineIcon("imageDisplay",{NAME:"star",SVG_KEY:"imageDisplay"}),e.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.DefineIcon("image-align",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("image-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("image-align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),e.DefineIcon("image-align-center",{NAME:"align-justify",SVG_KEY:"alignCenter"}),e.DefineIcon("imageAlign",{NAME:"align-justify",SVG_KEY:"alignJustify"}),e.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.imageAlign.options;for(var i in a)a.hasOwnProperty(i)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'+i+'" title="'+this.language.translate(a[i])+'">'+this.icon.create("image-align-"+i)+'<span class="fr-sr-only">'+this.language.translate(a[i])+"</span></a></li>");return t+"</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"}),e.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.DefineIcon("imageRemove",{NAME:"trash",SVG_KEY:"remove"}),e.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.DefineIcon("imageBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.$,this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.DefineIcon("imageStyle",{NAME:"magic",SVG_KEY:"imageClass"}),e.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',a=this.opts.imageStyles;for(var i in a)if(a.hasOwnProperty(i)){var r=a[i];"object"==t(r)&&(r=r.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'+i+'">'+this.language.translate(r)+"</a></li>"}return e+"</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(e,t){var a=this.$,i=this.image.getEl();i&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=i.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.DefineIcon("imageAlt",{NAME:"info",SVG_KEY:"imageAltText"}),e.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),e.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.DefineIcon("imageSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"}),e.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),e.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt",SVG_KEY:"imageCaption"}),e.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(e){this.image.get()&&e.toggleClass("fr-active",this.image.hasCaption())}})});