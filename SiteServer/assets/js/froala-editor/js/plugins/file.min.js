!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.POPUP_TEMPLATES,{"file.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_PROGRESS_BAR_]"}),Object.assign(e.DEFAULTS,{fileUpload:!0,fileUploadURL:null,fileUploadParam:"file",fileUploadParams:{},fileUploadToS3:!1,fileUploadMethod:"POST",fileMaxSize:10485760,fileAllowedTypes:["*"],fileInsertButtons:["fileBack","|"],fileUseSelectedText:!1}),e.PLUGINS.file=function(t){var i,r=t.$,o="https://i.froala.com/upload",a=2,n=3,s=4,l=5,f=6,p={};function d(){var e=t.popups.get("file.insert");e||(e=S()),e.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),e.find(".fr-file-progress-bar-layer").addClass("fr-active"),e.find(".fr-buttons").hide(),c(t.language.translate("Uploading"),0)}function u(e){var i=t.popups.get("file.insert");i&&(i.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),i.find(".fr-file-progress-bar-layer").removeClass("fr-active"),i.find(".fr-buttons").show(),e&&(t.events.focus(),t.popups.hide("file.insert")))}function c(e,i){var r=t.popups.get("file.insert");if(r){var o=r.find(".fr-file-progress-bar-layer");o.find("h3").text(e+(i?" "+i+"%":"")),o.removeClass("fr-error"),i?(o.find("div").removeClass("fr-indeterminate"),o.find("div > span").css("width",i+"%")):o.find("div").addClass("fr-indeterminate")}}function v(e,i,r){t.edit.on(),t.events.focus(!0),t.selection.restore(),t.opts.fileUseSelectedText&&t.selection.text().length&&(i=t.selection.text()),t.html.insert('<a href="'+e+'" target="_blank" id="fr-inserted-file" class="fr-file">'+i+"</a>");var o=t.$el.find("#fr-inserted-file");o.removeAttr("id"),t.popups.hide("file.insert"),t.undo.saveStep(),w(),t.events.trigger("file.inserted",[o,r])}function g(){b(s,this.response||this.responseText||this.responseXML)}function h(e){if(e.lengthComputable){var i=e.loaded/e.total*100|0;c(t.language.translate("Uploading"),i)}}function b(e,i){t.edit.on(),function(e){d();var i=t.popups.get("file.insert").find(".fr-file-progress-bar-layer");i.addClass("fr-error");var r=i.find("h3");r.text(e),t.events.disableBlur(),r.focus()}(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("file.error",[{code:e,message:p[e]},i])}function m(){t.edit.on(),u(!0)}function y(e){if(void 0!==e&&0<e.length){if(!1===t.events.trigger("file.beforeUpload",[e]))return!1;var i,p=e[0];if((null===t.opts.fileUploadURL||t.opts.fileUploadURL===o)&&!t.opts.fileUploadToS3)return function(e){var i=new FileReader;i.onload=function(){for(var r=i.result,o=atob(i.result.split(",")[1]),a=[],n=0;n<o.length;n++)a.push(o.charCodeAt(n));r=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:e.type})),t.file.insert(r,e.name,null)},d(),i.readAsDataURL(e)}(p),!1;if(p.size>t.opts.fileMaxSize)return b(l),!1;if(t.opts.fileAllowedTypes.indexOf("*")<0&&t.opts.fileAllowedTypes.indexOf(p.type.replace(/file\//g,""))<0)return b(f),!1;if(t.drag_support.formdata&&(i=t.drag_support.formdata?new FormData:null),i){var u;if(!1!==t.opts.fileUploadToS3)for(u in i.append("key",t.opts.fileUploadToS3.keyStart+(new Date).getTime()+"-"+(p.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",p.type),t.opts.fileUploadToS3.params)t.opts.fileUploadToS3.params.hasOwnProperty(u)&&i.append(u,t.opts.fileUploadToS3.params[u]);for(u in t.opts.fileUploadParams)t.opts.fileUploadParams.hasOwnProperty(u)&&i.append(u,t.opts.fileUploadParams[u]);i.append(t.opts.fileUploadParam,p);var c=t.opts.fileUploadURL;t.opts.fileUploadToS3&&(c=t.opts.fileUploadToS3.uploadURL?t.opts.fileUploadToS3.uploadURL:"https://"+t.opts.fileUploadToS3.region+".amazonaws.com/"+t.opts.fileUploadToS3.bucket);var y=t.core.getXHR(c,t.opts.fileUploadMethod);y.onload=function(){(function(e){var i=this.status,o=this.response,l=this.responseXML,f=this.responseText;try{if(t.opts.fileUploadToS3)if(201===i){var p=function(e){try{var i=r(e).find("Location").text(),o=r(e).find("Key").text();return!1===t.events.trigger("file.uploadedToS3",[i,o,e],!0)?(t.edit.on(),!1):i}catch(t){return b(s,e),!1}}(l);p&&v(p,e,o||l)}else b(s,o||l);else if(200<=i&&i<300){var d=function(e){try{if(!1===t.events.trigger("file.uploaded",[e],!0))return t.edit.on(),!1;var i=JSON.parse(e);return i.link?i:(b(a,e),!1)}catch(t){return b(s,e),!1}}(f);d&&v(d.link,e,o||f)}else b(n,o||f)}catch(e){b(s,o||f)}}).call(y,p.name)},y.onerror=g,y.upload.onprogress=h,y.onabort=m,d();var U=t.popups.get("file.insert");U&&(U.off("abortUpload"),U.on("abortUpload",function(){4!==y.readyState&&y.abort()})),y.send(i)}}}function U(){u()}function S(e){if(e)return t.popups.onHide("file.insert",U),!0;var i;t.opts.fileUpload||t.opts.fileInsertButtons.splice(t.opts.fileInsertButtons.indexOf("fileUpload"),1),i='<div class="fr-buttons fr-tabs">'+t.button.buildList(t.opts.fileInsertButtons)+"</div>";var o="";t.opts.fileUpload&&(o='<div class="fr-file-upload-layer fr-layer fr-active" id="fr-file-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop file")+"</strong><br>("+t.language.translate("or click")+')<div class="fr-form"><input type="file" name="'+t.opts.fileUploadParam+'" accept="'+(0<=t.opts.fileAllowedTypes.indexOf("*")?"/":"")+t.opts.fileAllowedTypes.join(", ").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-file-upload-layer-'+t.id+'" role="button"></div></div>');var a={buttons:i,upload_layer:o,progress_bar:'<div class="fr-file-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="fileDismissError" tabIndex="2" role="button">OK</button></div></div>'},n=t.popups.create("file.insert",a);return function(e){t.events.$on(e,"dragover dragenter",".fr-file-upload-layer",function(){return r(this).addClass("fr-drop"),!1},!0),t.events.$on(e,"dragleave dragend",".fr-file-upload-layer",function(){return r(this).removeClass("fr-drop"),!1},!0),t.events.$on(e,"drop",".fr-file-upload-layer",function(i){i.preventDefault(),i.stopPropagation(),r(this).removeClass("fr-drop");var o=i.originalEvent.dataTransfer;o&&o.files&&(e.data("instance")||t).file.upload(o.files)},!0),t.helpers.isIOS()&&t.events.$on(e,"touchstart",'.fr-file-upload-layer input[type="file"]',function(){r(this).trigger("click")}),t.events.$on(e,"change",'.fr-file-upload-layer input[type="file"]',function(){if(this.files){var i=e.data("instance")||t;i.events.disableBlur(),e.find("input:focus").blur(),i.events.enableBlur(),i.file.upload(this.files)}r(this).val("")},!0)}(n),n}function C(e){t.node.hasClass(e,"fr-file")}function T(i){var r=i.originalEvent.dataTransfer;if(r&&r.files&&r.files.length){var o=r.files[0];if(o&&void 0!==o.type){if(o.type.indexOf("image")<0){if(!t.opts.fileUpload)return i.preventDefault(),i.stopPropagation(),!1;t.markers.remove(),t.markers.insertAtPoint(i.originalEvent),t.$el.find(".fr-marker").replaceWith(e.MARKERS),t.popups.hideAll();var a=t.popups.get("file.insert");return a||(a=S()),t.popups.setContainer("file.insert",t.$sc),t.popups.show("file.insert",i.originalEvent.pageX,i.originalEvent.pageY),d(),y(r.files),i.preventDefault(),i.stopPropagation(),!1}}else o.type.indexOf("image")<0&&(i.preventDefault(),i.stopPropagation())}}function w(){var e,r=Array.prototype.slice.call(t.el.querySelectorAll("a.fr-file")),o=[];for(e=0;e<r.length;e++)o.push(r[e].getAttribute("href"));if(i)for(e=0;e<i.length;e++)o.indexOf(i[e].getAttribute("href"))<0&&t.events.trigger("file.unlink",[i[e]]);i=r}return p[1]="File cannot be loaded from the passed link.",p[a]="No link in upload response.",p[n]="Error during file upload.",p[s]="Parsing response failed.",p[l]="File is too large.",p[f]="File file type is invalid.",p[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",{_init:function(){t.events.on("drop",T),t.events.$on(t.$win,"keydown",function(i){var r=i.which,o=t.popups.get("file.insert");o&&r===e.KEYCODE.ESC&&o.trigger("abortUpload")}),t.events.on("destroy",function(){var e=t.popups.get("file.insert");e&&e.trigger("abortUpload")}),t.events.on("link.beforeRemove",C),t.$wp&&(w(),t.events.on("contentChanged",w)),S(!0)},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertFile"]'),i=t.popups.get("file.insert");if(i||(i=S()),u(),!i.hasClass("fr-active"))if(t.popups.refresh("file.insert"),t.popups.setContainer("file.insert",t.$tb),e.isVisible){var r=t.button.getPosition(e),o=r.left,a=r.top;t.popups.show("file.insert",o,a,e.outerHeight())}else t.position.forSelection(i),t.popups.show("file.insert")},upload:y,insert:v,back:function(){t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("file.insert"),t.toolbar.showInline()},hideProgressBar:u}},e.DefineIcon("insertFile",{NAME:"file-o",FA5NAME:"file",SVG_KEY:"insertFile"}),e.RegisterCommand("insertFile",{title:"Upload File",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("file.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("file.insert")):this.file.showInsertPopup()},plugin:"file"}),e.DefineIcon("fileBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("fileBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.file.back()},refresh:function(e){this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.RegisterCommand("fileDismissError",{title:"OK",callback:function(){this.file.hideProgressBar(!0)}})});