!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]"}),Object.assign(e.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableDefaultWidth:"100%",tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),e.PLUGINS.table=function(t){var l,a,n,r,s,o,i,f=t.$;function c(){var e=R();if(e){var l=t.popups.get("table.edit");if(l||(l=u()),l){t.popups.setContainer("table.edit",t.$sc);var a=y(e),n=a.left+(a.right-a.left)/2,r=a.bottom;t.popups.show("table.edit",n,r,a.bottom-a.top,!0),t.edit.isDisabled()&&(1<J().length&&t.toolbar.disable(),t.$el.removeClass("fr-no-selection"),t.edit.on(),t.button.bulkRefresh(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell").last().get(0)),t.selection.restore())}}}function d(){0===J().length&&t.toolbar.enable()}function p(l){if(l)return t.popups.onHide("table.insert",function(){t.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseover")}),!0;var a="";0<t.opts.tableInsertButtons.length&&(a='<div class="fr-buttons fr-tabs">'+t.button.buildList(t.opts.tableInsertButtons)+"</div>");var n={buttons:a,rows_columns:function(){for(var e='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',l=1;l<=t.opts.tableInsertMaxSize;l++){for(var a=1;a<=t.opts.tableInsertMaxSize;a++){var n="inline-block";2<l&&!t.helpers.isMobile()&&(n="none");var r="fr-table-cell ";1==l&&1==a&&(r+=" hover"),e+='<span class="fr-command '+r+'" tabIndex="-1" data-cmd="tableInsert" data-row="'+l+'" data-col="'+a+'" data-param1="'+l+'" data-param2="'+a+'" style="display: '+n+';" role="button"><span></span><span class="fr-sr-only">'+l+" &times; "+a+"&nbsp;&nbsp;&nbsp;</span></span>"}e+='<div class="new-line"></div>'}return e+"</div></div>"}()},r=t.popups.create("table.insert",n);return t.events.$on(r,"mouseover",".fr-table-size .fr-select-table-size .fr-table-cell",function(e){h(f(e.currentTarget))},!0),function(l){t.events.$on(l,"focus","[tabIndex]",function(e){h(f(e.currentTarget))}),t.events.on("popup.tab",function(l){var a=f(l.currentTarget);if(!t.popups.isVisible("table.insert")||!a.is("span, a"))return!0;var n,r=l.which;if(e.KEYCODE.ARROW_UP==r||e.KEYCODE.ARROW_DOWN==r||e.KEYCODE.ARROW_LEFT==r||e.KEYCODE.ARROW_RIGHT==r){if(a.is("span.fr-table-cell")){var s=a.parent().find("span.fr-table-cell"),o=s.index(a),i=t.opts.tableInsertMaxSize,c=o%i,d=Math.floor(o/i);e.KEYCODE.ARROW_UP==r?d=Math.max(0,d-1):e.KEYCODE.ARROW_DOWN==r?d=Math.min(t.opts.tableInsertMaxSize-1,d+1):e.KEYCODE.ARROW_LEFT==r?c=Math.max(0,c-1):e.KEYCODE.ARROW_RIGHT==r&&(c=Math.min(t.opts.tableInsertMaxSize-1,c+1));var p=d*i+c,u=f(s.get(p));h(u),t.events.disableBlur(),u.focus(),n=!1}}else e.KEYCODE.ENTER==r&&(t.button.exec(a),n=!1);return!1===n&&(l.preventDefault(),l.stopPropagation()),n},!0)}(r),r}function h(e){var l=e.data("row");null!==l&&(l=parseInt(l));var a=e.data("col");null!==a&&(a=parseInt(a));var n=e.parent();n.siblings(".fr-table-size-info").html(l+" &times; "+a),n.find("> span").removeClass("hover fr-active-item");for(var r=1;r<=t.opts.tableInsertMaxSize;r++)for(var s=0;s<=t.opts.tableInsertMaxSize;s++){var o=n.find('> span[data-row="'+r+'"][data-col="'+s+'"]');r<=l&&s<=a?o.addClass("hover"):r<=l+1||r<=2&&!t.helpers.isMobile()?o.css("display","inline-block"):2<r&&!t.helpers.isMobile()&&o.css("display","none")}e.addClass("fr-active-item")}function u(e){if(e)return t.popups.onHide("table.edit",d),!0;if(0<t.opts.tableEditButtons.length){var l={buttons:'<div class="fr-buttons">'.concat(t.button.buildList(t.opts.tableEditButtons),"</div>")},a=t.popups.create("table.edit",l);return t.events.$on(t.$wp,"scroll.table-edit",function(){t.popups.isVisible("table.edit")&&c()}),a}return!1}function b(){if(0<J().length){var e=Z();t.selection.setBefore(e.get(0))||t.selection.setAfter(e.get(0)),t.selection.restore(),t.popups.hide("table.edit"),e.remove(),t.toolbar.enable()}}function g(e){var l=Z();if(0<l.length){if(0<t.$el.find("th.fr-selected-cell").length&&"above"==e)return;var a,n,r,s=R(),o=D(s);if(null==o)return;n="above"==e?o.min_i:o.max_i;var i="<tr>";for(a=0;a<s[n].length;a++)if("below"==e&&n<s.length-1&&s[n][a]==s[n+1][a]||"above"==e&&0<n&&s[n][a]==s[n-1][a]){if(0===a||0<a&&s[n][a]!=s[n][a-1]){var d=f(s[n][a]);d.attr("rowspan",parseInt(d.attr("rowspan"),10)+1)}}else i+='<td style="'+f(s[n][a]).attr("style")+'" ><br></td>';i+="</tr>",r=0<t.$el.find("th.fr-selected-cell").length&&"below"==e?f(l.find("tbody").not(l.find("> table tbody"))):f(l.find("tr").not(l.find("> table tr")).get(n)),"below"==e?"TBODY"==r.attr("tagName")?r.prepend(i):r[0].parentNode&&r[0].insertAdjacentHTML("afterend",i):"above"==e&&(r.before(i),t.popups.isVisible("table.edit")&&c())}}function m(e,t,l){var a,n,r,s,o,i=0,f=R(l);if(e<(t=Math.min(t,f[0].length-1)))for(n=e;n<=t;n++)if(!(e<n&&f[0][n]==f[0][n-1])&&1<(s=Math.min(parseInt(f[0][n].getAttribute("colspan"),10)||1,t-e+1))&&f[0][n]==f[0][n+1])for(i=s-1,a=1;a<f.length;a++)if(f[a][n]!=f[a-1][n]){for(r=n;r<n+s;r++)if(1<(o=parseInt(f[a][r].getAttribute("colspan"),10)||1)&&f[a][r]==f[a][r+1])r+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&w(f,i,"colspan",0,f.length-1,e,t)}function v(e,t,l){var a,n,r,s,o,i=0,f=R(l);if(e<(t=Math.min(t,f.length-1)))for(a=e;a<=t;a++)if(!(e<a&&f[a][0]==f[a-1][0])&&1<(s=Math.min(parseInt(f[a][0].getAttribute("rowspan"),10)||1,t-e+1))&&f[a][0]==f[a+1][0])for(i=s-1,n=1;n<f[0].length;n++)if(f[a][n]!=f[a][n-1]){for(r=a;r<a+s;r++)if(1<(o=parseInt(f[r][n].getAttribute("rowspan"),10)||1)&&f[r][n]==f[r+1][n])r+=i=Math.min(i,o-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&w(f,i,"rowspan",e,t,0,f[0].length-1)}function w(e,t,l,a,n,r,s){var o,i,f;for(o=a;o<=n;o++)for(i=r;i<=s;i++)a<o&&e[o][i]==e[o-1][i]||r<i&&e[o][i]==e[o][i-1]||1<(f=parseInt(e[o][i].getAttribute(l),10)||1)&&(1<f-t?e[o][i].setAttribute(l,f-t):e[o][i].removeAttribute(l))}function C(e,t,l,a,n){v(e,t,n),m(l,a,n)}function E(e){var l=t.$el.find(".fr-selected-cell");"REMOVE"!=e?l.css("background-color",t.helpers.HEXtoRGB(e)):l.css("background-color",""),c()}function R(e){var t=[];return null==(e=e||null)&&0<J().length&&(e=Z()),e&&e.findVisible("tr").not(e.find("> table tr")).each(function(e,l){var a=f(l),n=0;a.find("> th, > td").each(function(l,a){for(var r=f(a),s=parseInt(r.attr("colspan"),10)||1,o=parseInt(r.attr("rowspan"),10)||1,i=e;i<e+o;i++)for(var c=n;c<n+s;c++)t[i]||(t[i]=[]),t[i][c]?n++:t[i][c]=a;n+=s})}),t}function O(e,t){for(var l=0;l<t.length;l++)for(var a=0;a<t[l].length;a++)if(t[l][a]==e)return{row:l,col:a}}function A(e,t,l){for(var a=e+1,n=t+1;a<l.length;){if(l[a][t]!=l[e][t]){a--;break}a++}for(a==l.length&&a--;n<l[e].length;){if(l[e][n]!=l[e][t]){n--;break}n++}return n==l[e].length&&n--,{row:a,col:n}}function x(){t.el.querySelector(".fr-cell-fixed")&&t.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),t.el.querySelector(".fr-cell-handler")&&t.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function _(){var e=t.$el.find(".fr-selected-cell");0<e.length&&e.each(function(){var e=f(this);e.removeClass("fr-selected-cell"),""===e.attr("class")&&e.removeAttr("class")}),x()}function $(){t.events.disableBlur(),t.selection.clear(),t.$el.addClass("fr-no-selection"),t.$el.blur(),t.events.enableBlur()}function D(e){var l=t.$el.find(".fr-selected-cell");if(0<l.length){var a,n=e.length,r=0,s=e[0].length,o=0;for(a=0;a<l.length;a++){var i=O(l[a],e),f=A(i.row,i.col,e);n=Math.min(i.row,n),r=Math.max(f.row,r),s=Math.min(i.col,s),o=Math.max(f.col,o)}return{min_i:n,max_i:r,min_j:s,max_j:o}}return null}function y(e){var t=D(e);if(null!=t){var l=f(e[t.min_i][t.min_j]),a=f(e[t.min_i][t.max_j]),n=f(e[t.max_i][t.min_j]);return{left:l.length&&l.offset().left,right:a.length&&a.offset().left+a.outerWidth(),top:l.length&&l.offset().top,bottom:n.length&&n.offset().top+n.outerHeight()}}}function M(e,l){if(f(e).is(l))_(),f(e).addClass("fr-selected-cell");else{$(),t.edit.off();var a=R(),n=O(e,a),r=O(l,a),s=function e(t,l,a,n,r){var s,o,i,c,d=t,p=l,h=a,u=n;for(s=d;s<=p;s++)(1<(parseInt(f(r[s][h]).attr("rowspan"),10)||1)||1<(parseInt(f(r[s][h]).attr("colspan"),10)||1))&&(c=A((i=O(r[s][h],r)).row,i.col,r),d=Math.min(i.row,d),p=Math.max(c.row,p),h=Math.min(i.col,h),u=Math.max(c.col,u)),(1<(parseInt(f(r[s][u]).attr("rowspan"),10)||1)||1<(parseInt(f(r[s][u]).attr("colspan"),10)||1))&&(c=A((i=O(r[s][u],r)).row,i.col,r),d=Math.min(i.row,d),p=Math.max(c.row,p),h=Math.min(i.col,h),u=Math.max(c.col,u));for(o=h;o<=u;o++)(1<(parseInt(f(r[d][o]).attr("rowspan"),10)||1)||1<(parseInt(f(r[d][o]).attr("colspan"),10)||1))&&(c=A((i=O(r[d][o],r)).row,i.col,r),d=Math.min(i.row,d),p=Math.max(c.row,p),h=Math.min(i.col,h),u=Math.max(c.col,u)),(1<(parseInt(f(r[p][o]).attr("rowspan"),10)||1)||1<(parseInt(f(r[p][o]).attr("colspan"),10)||1))&&(c=A((i=O(r[p][o],r)).row,i.col,r),d=Math.min(i.row,d),p=Math.max(c.row,p),h=Math.min(i.col,h),u=Math.max(c.col,u));return d==t&&p==l&&h==a&&u==n?{min_i:t,max_i:l,min_j:a,max_j:n}:e(d,p,h,u,r)}(Math.min(n.row,r.row),Math.max(n.row,r.row),Math.min(n.col,r.col),Math.max(n.col,r.col),a);_(),e.classList.add("fr-cell-fixed"),l.classList.add("fr-cell-handler");for(var o=s.min_i;o<=s.max_i;o++)for(var i=s.min_j;i<=s.max_j;i++)f(a[o][i]).addClass("fr-selected-cell")}}function S(e){var l=null,a=f(e.target);return"TD"==e.target.tagName||"TH"==e.target.tagName?l=e.target:0<a.closest("td",a.closest("tr")[0]).length?l=a.closest("td",a.closest("tr")[0]).get(0):0<a.closest("th",a.closest("thead")[0]).length&&(l=a.closest("th",a.closest("thead")[0]).get(0)),-1===t.$el.html.toString().search(l)?null:l}function I(){_(),t.popups.hide("table.edit")}function N(e){var l=S(e);if("false"==f(l).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(0<J().length&&!l&&I(),!t.edit.isDisabled()||t.popups.isVisible("table.edit"))if(1!=e.which||1==e.which&&t.helpers.isMac()&&e.ctrlKey)(3==e.which||1==e.which&&t.helpers.isMac()&&e.ctrlKey)&&l&&I();else if(r=!0,l){0<J().length&&!e.shiftKey&&I(),e.stopPropagation(),t.events.trigger("image.hideResizer"),t.events.trigger("video.hideResizer"),n=!0;var a=l.tagName.toLowerCase();e.shiftKey&&0<t.$el.find(a+".fr-selected-cell").length?f(t.$el.find(a+".fr-selected-cell").closest("table")).is(f(l).closest("table"))?M(s,l):$():((t.keys.ctrlKey(e)||e.shiftKey)&&(1<J().length||0===f(l).find(t.selection.element()).length&&!f(l).is(t.selection.element()))&&$(),s=l,0<t.opts.tableEditButtons.length&&M(s,s))}}function T(e){if(t.popups.areVisible())return!0;if(n||t.$tb.is(e.target)||t.$tb.is(f(e.target).closest(".fr-toolbar"))||(0<J().length&&t.toolbar.enable(),_()),!(1!=e.which||1==e.which&&t.helpers.isMac()&&e.ctrlKey)&&(r=!1,n&&(n=!1,S(e)||1!=J().length?0<J().length&&(t.selection.isCollapsed()?c():(_(),t.edit.on())):_()),i)){i=!1,l.removeClass("fr-moving"),t.$el.removeClass("fr-no-selection"),t.edit.on();var a=parseFloat(l.css("left"))+t.opts.tableResizerOffset+t.$wp.offset().left;t.opts.iframe&&(a-=t.$iframe.offset().left),l.data("release-position",a),l.removeData("max-left"),l.removeData("max-right"),function(){var e=l.data("origin"),a=l.data("release-position");if(e!==a){var n=l.data("first"),r=l.data("second"),s=l.data("table"),o=s.outerWidth();if(t.undo.canDo()||t.undo.saveStep(),null!=n&&null!=r){var i,c,d,p=R(s),h=[],u=[],b=[],g=[];for(i=0;i<p.length;i++)c=f(p[i][n]),d=f(p[i][r]),h[i]=c.outerWidth(),b[i]=d.outerWidth(),u[i]=h[i]/o*100,g[i]=b[i]/o*100;for(i=0;i<p.length;i++)if(c=f(p[i][n]),d=f(p[i][r]),p[i][n]!=p[i][r]){var m=(u[i]*(h[i]+a-e)/h[i]).toFixed(4);c.css("width",m+"%"),d.css("width",(u[i]+g[i]-m).toFixed(4)+"%")}}else{var v,w=s.parent(),C=o/w.width()*100,E=(parseInt(s.css("margin-left"),10)||0)/w.width()*100,O=(parseInt(s.css("margin-right"),10)||0)/w.width()*100;"rtl"==t.opts.direction&&0===r||"rtl"!=t.opts.direction&&0!==r?(v=(o+a-e)/o*C,s.css("margin-right","calc(100% - "+Math.round(v).toFixed(4)+"% - "+Math.round(E).toFixed(4)+"%)")):("rtl"==t.opts.direction&&0!==r||"rtl"!=t.opts.direction&&0===r)&&(v=(o-a+e)/o*C,s.css("margin-left","calc(100% - "+Math.round(v).toFixed(4)+"% - "+Math.round(O).toFixed(4)+"%)")),s.css("width",Math.round(v).toFixed(4)+"%")}t.selection.restore(),t.undo.saveStep(),t.events.trigger("table.resized",[s.get(0)])}l.removeData("origin"),l.removeData("release-position"),l.removeData("first"),l.removeData("second"),l.removeData("table")}(),Y()}}function K(e){if(!0===n&&0<t.opts.tableEditButtons.length){if(f(e.currentTarget).closest("table").is(Z())){if("TD"==e.currentTarget.tagName&&0===t.$el.find("th.fr-selected-cell").length)return void M(s,e.currentTarget);if("TH"==e.currentTarget.tagName&&0===t.$el.find("td.fr-selected-cell").length)return void M(s,e.currentTarget)}$()}}function B(e,l,a,n){for(var r,s=l;s!=t.el&&"TD"!=s.tagName&&"TH"!=s.tagName&&("up"==n?r=s.previousElementSibling:"down"==n&&(r=s.nextElementSibling),!r);)s=s.parentNode;"TD"==s.tagName||"TH"==s.tagName?function(e,l){for(var a=e;a&&"TABLE"!=a.tagName&&a.parentNode!=t.el;)a=a.parentNode;if(a&&"TABLE"==a.tagName){var n=R(f(a));"up"==l?z(O(e,n),a,n):"down"==l&&k(O(e,n),a,n)}}(s,n):r&&("up"==n&&t.selection.setAtEnd(r),"down"==n&&t.selection.setAtStart(r))}function z(e,l,a){0<e.row?t.selection.setAtEnd(a[e.row-1][e.col]):B(0,l,0,"up")}function k(e,l,a){var n=parseInt(a[e.row][e.col].getAttribute("rowspan"),10)||1;e.row<a.length-n?t.selection.setAtStart(a[e.row+n][e.col]):B(0,l,0,"down")}function Y(){l&&(l.find("div").css("opacity",0),l.css("top",0),l.css("left",0),l.css("height",0),l.find("div").css("height",0),l.hide())}function W(){a&&a.removeClass("fr-visible").css("left","-9999px")}function L(e,l){if(t.$box.find(".fr-line-breaker").isVisible())return!1;a||U(),t.$box.append(a),a.data("instance",t);var n,r=f(l).find("tr").first(),s=e.pageX,o=0,i=0;if(t.opts.iframe){var c=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),d=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"));o+=t.$iframe.offset().left-t.helpers.scrollLeft()+d,i+=t.$iframe.offset().top-t.helpers.scrollTop()+c}r.find("th, td").each(function(){var e=f(this);return e.offset().left<=s&&s<e.offset().left+e.outerWidth()/2?(n=parseInt(a.find("a").css("width"),10),a.css("top",i+e.offset().top-t.$box.offset().top-n-5),a.css("left",o+e.offset().left-t.$box.offset().left-n/2),a.data("selected-cell",e),a.data("position","before"),a.addClass("fr-visible"),!1):e.offset().left+e.outerWidth()/2<=s&&s<e.offset().left+e.outerWidth()?(n=parseInt(a.find("a").css("width"),10),a.css("top",i+e.offset().top-t.$box.offset().top-n-5),a.css("left",o+e.offset().left-t.$box.offset().left+e.outerWidth()-n/2),a.data("selected-cell",e),a.data("position","after"),a.addClass("fr-visible"),!1):void 0})}function F(e,l){if(t.$box.find(".fr-line-breaker").isVisible())return!1;a||U(),t.$box.append(a),a.data("instance",t);var n,r=f(l),s=e.pageY,o=0,i=0;if(t.opts.iframe){var c=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),d=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"));o+=t.$iframe.offset().left-t.helpers.scrollLeft()+d,i+=t.$iframe.offset().top-t.helpers.scrollTop()+c}r.find("tr").each(function(){var e=f(this);return e.offset().top<=s&&s<e.offset().top+e.outerHeight()/2?(n=parseInt(a.find("a").css("width"),10),a.css("top",i+e.offset().top-t.$box.offset().top-n/2),a.css("left",o+e.offset().left-t.$box.offset().left-n-5),a.data("selected-cell",e.find("td").first()),a.data("position","above"),a.addClass("fr-visible"),!1):e.offset().top+e.outerHeight()/2<=s&&s<e.offset().top+e.outerHeight()?(n=parseInt(a.find("a").css("width"),10),a.css("top",i+e.offset().top-t.$box.offset().top+e.outerHeight()-n/2),a.css("left",o+e.offset().left-t.$box.offset().left-n-5),a.data("selected-cell",e.find("td").first()),a.data("position","below"),a.addClass("fr-visible"),!1):void 0})}function H(e){o=null;var n=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset);t.opts.tableResizer&&(!t.popups.areVisible()||t.popups.areVisible()&&t.popups.isVisible("table.edit"))&&function(e,a){var n=f(a),r=n.closest("table"),s=r.parent();if(a&&"TD"!=a.tagName&&"TH"!=a.tagName&&(0<n.closest("td").length?a=n.closest("td"):0<n.closest("th").length&&(a=n.closest("th"))),!a||"TD"!=a.tagName&&"TH"!=a.tagName)l&&n.get(0)!=l.get(0)&&n.parent().get(0)!=l.get(0)&&t.core.sameInstance(l)&&Y();else{if(n=f(a),0===t.$el.find(n).length)return!1;var o=n.offset().left-1,c=o+n.outerWidth();if(Math.abs(e.pageX-o)<=t.opts.tableResizerOffset||Math.abs(c-e.pageX)<=t.opts.tableResizerOffset){var d,p,h,u,b,g=R(r),m=O(a,g),v=A(m.row,m.col,g),w=r.offset().top,C=r.outerHeight()-1;"rtl"!=t.opts.direction?e.pageX-o<=t.opts.tableResizerOffset?(h=o,0<m.col?(u=o-P(m.col-1,g)+t.opts.tableResizingLimit,b=o+P(m.col,g)-t.opts.tableResizingLimit,d=m.col-1,p=m.col):(d=null,p=0,u=r.offset().left-1-parseInt(r.css("margin-left"),10),b=r.offset().left-1+r.width()-g[0].length*t.opts.tableResizingLimit)):c-e.pageX<=t.opts.tableResizerOffset&&(h=c,v.col<g[v.row].length&&g[v.row][v.col+1]?(u=c-P(v.col,g)+t.opts.tableResizingLimit,b=c+P(v.col+1,g)-t.opts.tableResizingLimit,d=v.col,p=v.col+1):(d=v.col,p=null,u=r.offset().left-1+g[0].length*t.opts.tableResizingLimit,b=s.offset().left-1+s.width()+parseFloat(s.css("padding-left")))):c-e.pageX<=t.opts.tableResizerOffset?(h=c,0<m.col?(u=c-P(m.col,g)+t.opts.tableResizingLimit,b=c+P(m.col-1,g)-t.opts.tableResizingLimit,d=m.col,p=m.col-1):(d=null,p=0,u=r.offset().left+g[0].length*t.opts.tableResizingLimit,b=s.offset().left-1+s.width()+parseFloat(s.css("padding-left")))):e.pageX-o<=t.opts.tableResizerOffset&&(h=o,v.col<g[v.row].length&&g[v.row][v.col+1]?(u=o-P(v.col+1,g)+t.opts.tableResizingLimit,b=o+P(v.col,g)-t.opts.tableResizingLimit,d=v.col+1,p=v.col):(d=v.col,p=null,u=s.offset().left+parseFloat(s.css("padding-left")),b=r.offset().left-1+r.width()-g[0].length*t.opts.tableResizingLimit)),l||(t.shared.$table_resizer||(t.shared.$table_resizer=f(document.createElement("div")).attr("class","fr-table-resizer").html("<div></div>")),l=t.shared.$table_resizer,t.events.$on(l,"mousedown",function(e){return!t.core.sameInstance(l)||(0<J().length&&I(),1==e.which?(t.selection.save(),i=!0,l.addClass("fr-moving"),$(),t.edit.off(),l.find("div").css("opacity",1),!1):void 0)}),t.events.$on(l,"mousemove",function(e){if(!t.core.sameInstance(l))return!0;i&&(t.opts.iframe&&(e.pageX-=t.$iframe.offset().left),X(e))}),t.events.on("shared.destroy",function(){l.html("").removeData().remove(),l=null},!0),t.events.on("destroy",function(){t.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),f("body").first().append(l.hide())},!0)),l.data("table",r),l.data("first",d),l.data("second",p),l.data("instance",t),t.$wp.append(l);var E=h-t.win.pageXOffset-t.opts.tableResizerOffset-t.$wp.offset().left,x=w-t.$wp.offset().top+t.$wp.scrollTop();if(t.opts.iframe){var _=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),D=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"));E+=t.$iframe.offset().left+D,x+=t.$iframe.offset().top+_,u+=t.$iframe.offset().left,b+=t.$iframe.offset().left}l.data("max-left",u),l.data("max-right",b),l.data("origin",h-t.win.pageXOffset),l.css("top",x),l.css("left",E),l.css("height",C),l.find("div").css("height",C),l.css("padding-left",t.opts.tableResizerOffset),l.css("padding-right",t.opts.tableResizerOffset),l.show()}else t.core.sameInstance(l)&&Y()}}(e,n),!t.opts.tableInsertHelper||t.popups.areVisible()||t.$tb.hasClass("fr-inline")&&t.$tb.isVisible()||function(e,l){if(0===J().length){var n,r,s;if(l&&("HTML"==l.tagName||"BODY"==l.tagName||t.node.isElement(l)))for(n=1;n<=t.opts.tableInsertHelperOffset;n++){if(r=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset+n),f(r).hasClass("fr-tooltip"))return!0;if(r&&("TH"==r.tagName||"TD"==r.tagName||"TABLE"==r.tagName)&&(f(r).parents(".fr-wrapper").length||t.opts.iframe)&&"false"!=f(r).closest("table").attr("contenteditable"))return L(e,f(r).closest("table")),!0;if(s=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset+n,e.pageY-t.win.pageYOffset),f(s).hasClass("fr-tooltip"))return!0;if(s&&("TH"==s.tagName||"TD"==s.tagName||"TABLE"==s.tagName)&&(f(s).parents(".fr-wrapper").length||t.opts.iframe)&&"false"!=f(s).closest("table").attr("contenteditable"))return F(e,f(s).closest("table")),!0}t.core.sameInstance(a)&&W()}}(e,n)}function V(){if(i){var e=l.data("table").offset().top-t.win.pageYOffset;if(t.opts.iframe){var a=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top"));e+=t.$iframe.offset().top-t.helpers.scrollTop()+a}l.css("top",e)}}function P(e,t){var l,a=f(t[0][e]).outerWidth();for(l=1;l<t.length;l++)a=Math.min(a,f(t[l][e]).outerWidth());return a}function j(e,t,l){var a,n=0;for(a=e;a<=t;a++)n+=P(a,l);return n}function X(e){if(1<J().length&&r&&$(),!1===r&&!1===n&&!1===i)o&&clearTimeout(o),t.edit.isDisabled()&&!t.popups.isVisible("table.edit")||(o=setTimeout(H,30,e));else if(i){var a=e.pageX-t.win.pageXOffset;t.opts.iframe&&(a+=t.$iframe.offset().left);var s=l.data("max-left"),f=l.data("max-right");s<=a&&a<=f?l.css("left",a-t.opts.tableResizerOffset-t.$wp.offset().left):a<s&&parseFloat(l.css("left"),10)>s-t.opts.tableResizerOffset?l.css("left",s-t.opts.tableResizerOffset-t.$wp.offset().left):f<a&&parseFloat(l.css("left"),10)<f-t.opts.tableResizerOffset&&l.css("left",f-t.opts.tableResizerOffset-t.$wp.offset().left)}else r&&W()}function G(l){t.node.isEmpty(l.get(0))?l.prepend(e.MARKERS):l.prepend(e.START_MARKER).append(e.END_MARKER)}function U(){t.shared.$ti_helper||(t.shared.$ti_helper=f(document.createElement("div")).attr("class","fr-insert-helper").html('<a class="fr-floating-btn" role="button" tabIndex="-1" title="'+t.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a>'),t.events.bindClick(t.shared.$ti_helper,"a",function(){var e=a.data("selected-cell"),l=a.data("position"),n=a.data("instance")||t;"before"==l?(t.undo.saveStep(),e.addClass("fr-selected-cell"),n.table.insertColumn(l),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"after"==l?(t.undo.saveStep(),e.addClass("fr-selected-cell"),n.table.insertColumn(l),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"above"==l?(t.undo.saveStep(),e.addClass("fr-selected-cell"),n.table.insertRow(l),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"below"==l&&(t.undo.saveStep(),e.addClass("fr-selected-cell"),n.table.insertRow(l),e.removeClass("fr-selected-cell"),t.undo.saveStep()),W()}),t.events.on("shared.destroy",function(){t.shared.$ti_helper.html("").removeData().remove(),t.shared.$ti_helper=null},!0),t.events.$on(t.shared.$ti_helper,"mousemove",function(e){e.stopPropagation()},!0),t.events.$on(f(t.o_win),"scroll",function(){W()},!0),t.events.$on(t.$wp,"scroll",function(){W()},!0)),a=t.shared.$ti_helper,t.events.on("destroy",function(){a=null}),t.tooltip.bind(t.$box,".fr-insert-helper > a.fr-floating-btn")}function q(){s=null,clearTimeout(o)}function J(){return t.el.querySelectorAll(".fr-selected-cell")}function Z(){var e=J();if(e.length){for(var l=e[0];l&&"TABLE"!=l.tagName&&l.parentNode!=t.el;)l=l.parentNode;return l&&"TABLE"==l.tagName?f(l):f([])}return f([])}return{_init:function(){if(!t.$wp)return!1;if(!t.helpers.isMobile()){i=n=r=!1,t.events.$on(t.$el,"mousedown",N),t.popups.onShow("image.edit",function(){_(),n=r=!1}),t.popups.onShow("link.edit",function(){_(),n=r=!1}),t.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&_()}),t.events.$on(t.$el,"mouseover","th, td",K),t.events.$on(t.$win,"mouseup",T),t.opts.iframe&&t.events.$on(f(t.o_win),"mouseup",T),t.events.$on(t.$win,"mousemove",X),t.events.$on(f(t.o_win),"scroll",V),t.events.on("contentChanged",function(){0<J().length&&(c(),t.$el.find("img").on("load.selected-cells",function(){f(this).off("load.selected-cells"),0<J().length&&c()}))}),t.events.$on(f(t.o_win),"resize",function(){_()}),t.events.on("toolbar.esc",function(){if(0<J().length)return t.events.disableBlur(),t.events.focus(),!1},!0),t.events.$on(f(t.o_win),"keydown",function(){r&&n&&(n=r=!1,t.$el.removeClass("fr-no-selection"),t.edit.on(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell").last().get(0)),t.selection.restore(),_())}),t.events.$on(t.$el,"keydown",function(l){l.shiftKey?!1===function(l){var a=J();if(null!=a&&0<a.length){var n,r=R(),s=l.which,o=O(1==a.length?n=a[0]:(n=t.el.querySelector(".fr-cell-fixed"),t.el.querySelector(".fr-cell-handler")),r);if(e.KEYCODE.ARROW_RIGHT==s){if(o.col<r[0].length-1)return M(n,r[o.row][o.col+1]),!1}else if(e.KEYCODE.ARROW_DOWN==s){if(o.row<r.length-1)return M(n,r[o.row+1][o.col]),!1}else if(e.KEYCODE.ARROW_LEFT==s){if(0<o.col)return M(n,r[o.row][o.col-1]),!1}else if(e.KEYCODE.ARROW_UP==s&&0<o.row)return M(n,r[o.row-1][o.col]),!1}}(l)&&setTimeout(function(){c()},0):function(l){var a=l.which,n=t.selection.blocks();if(n.length&&("TD"==(n=n[0]).tagName||"TH"==n.tagName)){for(var r=n;r&&"TABLE"!=r.tagName&&r.parentNode!=t.el;)r=r.parentNode;if(r&&"TABLE"==r.tagName&&(e.KEYCODE.ARROW_LEFT==a||e.KEYCODE.ARROW_UP==a||e.KEYCODE.ARROW_RIGHT==a||e.KEYCODE.ARROW_DOWN==a)&&(0<J().length&&I(),t.browser.webkit&&(e.KEYCODE.ARROW_UP==a||e.KEYCODE.ARROW_DOWN==a))){var s=t.selection.ranges(0).startContainer;if(s.nodeType==Node.TEXT_NODE&&(e.KEYCODE.ARROW_UP==a&&(s.previousSibling&&"BR"!==s.previousSibling.tagName||s.previousSibling&&"BR"===s.previousSibling.tagName&&s.previousSibling.previousSibling)||e.KEYCODE.ARROW_DOWN==a&&(s.nextSibling&&"BR"!==s.nextSibling.tagName||s.nextSibling&&"BR"===s.nextSibling.tagName&&s.nextSibling.nextSibling)))return;l.preventDefault(),l.stopPropagation();var o=R(f(r)),i=O(n,o);e.KEYCODE.ARROW_UP==a?z(i,r,o):e.KEYCODE.ARROW_DOWN==a&&k(i,r,o),t.selection.restore()}}}(l)}),t.events.on("keydown",function(l){if(!1===function(l){if(l.which==e.KEYCODE.TAB){var a;if(0<J().length)a=t.$el.find(".fr-selected-cell").last();else{var n=t.selection.element();"TD"==n.tagName||"TH"==n.tagName?a=f(n):n!=t.el&&(0<f(n).parentsUntil(t.$el,"td").length?a=f(n).parents("td").first():0<f(n).parentsUntil(t.$el,"th").length&&(a=f(n).parents("th").first()))}if(a)return l.preventDefault(),!!(0===t.selection.get().focusOffset&&0<f(t.selection.element()).parentsUntil(t.$el,"ol, ul").length&&(0<f(t.selection.element()).closest("li").prev().length||f(t.selection.element()).is("li")&&0<f(t.selection.element()).prev().length))||(I(),l.shiftKey?0<a.prev().length?G(a.prev()):0<a.closest("tr").length&&0<a.closest("tr").prev().length?G(a.closest("tr").prev().find("td").last()):0<a.closest("tbody").length&&0<a.closest("table").find("thead tr").length&&G(a.closest("table").find("thead tr th").last()):0<a.next().length?G(a.next()):0<a.closest("tr").length&&0<a.closest("tr").next().length?G(a.closest("tr").next().find("td").first()):0<a.closest("thead").length&&0<a.closest("table").find("tbody tr").length?G(a.closest("table").find("tbody tr td").first()):(a.addClass("fr-selected-cell"),g("below"),_(),G(a.closest("tr").next().find("td").first())),t.selection.restore(),!1)}}(l))return!1;var a=J();if(0<a.length){if(0<a.length&&t.keys.ctrlKey(l)&&l.which==e.KEYCODE.A)return _(),t.popups.isVisible("table.edit")&&t.popups.hide("table.edit"),a=[],!0;if(l.which==e.KEYCODE.ESC&&t.popups.isVisible("table.edit"))return _(),t.popups.hide("table.edit"),l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation(),!(a=[]);if(1<a.length&&(l.which==e.KEYCODE.BACKSPACE||l.which==e.KEYCODE.DELETE)){t.undo.saveStep();for(var n=0;n<a.length;n++)f(a[n]).html("<br>"),n==a.length-1&&f(a[n]).prepend(e.MARKERS);return t.selection.restore(),t.undo.saveStep(),!(a=[])}if(1<a.length&&l.which!=e.KEYCODE.F10&&!t.keys.isBrowserAction(l))return l.preventDefault(),!(a=[])}else if(!(a=[])===function(l){if(l.altKey&&l.which==e.KEYCODE.SPACE){var a,n=t.selection.element();if("TD"==n.tagName||"TH"==n.tagName?a=n:0<f(n).closest("td").length?a=f(n).closest("td").get(0):0<f(n).closest("th").length&&(a=f(n).closest("th").get(0)),a)return l.preventDefault(),M(a,a),c(),!1}}(l))return!1},!0);var l=[];t.events.on("html.beforeGet",function(){l=J();for(var e=0;e<l.length;e++)l[e].className=(l[e].className||"").replace(/fr-selected-cell/g,"")}),t.events.on("html.afterGet",function(){for(var e=0;e<l.length;e++)l[e].className=(l[e].className?l[e].className.trim()+" ":"")+"fr-selected-cell";l=[]}),p(!0),u(!0)}t.events.on("destroy",q)},insert:function(l,a){var n,r,s="<table "+(t.opts.tableDefaultWidth?'style="width: '+t.opts.tableDefaultWidth+';" ':"")+'class="fr-inserted-table"><tbody>',o=100/a;for(n=0;n<l;n++){for(s+="<tr>",r=0;r<a;r++)s+="<td"+(t.opts.tableDefaultWidth?' style="width: '+o.toFixed(4)+'%;"':"")+">",0===n&&0===r&&(s+=e.MARKERS),s+="<br></td>";s+="</tr>"}s+="</tbody></table>",t.html.insert(s),t.selection.restore();var i=t.$el.find(".fr-inserted-table");i.removeClass("fr-inserted-table"),t.events.trigger("table.inserted",[i.get(0)])},remove:b,insertRow:g,deleteRow:function(){var e=Z();if(0<e.length){var l,a,n,r=R(),s=D(r);if(null==s)return;if(0===s.min_i&&s.max_i==r.length-1)b();else{for(l=s.max_i;l>=s.min_i;l--){for(n=f(e.find("tr").not(e.find("> table tr")).get(l)),a=0;a<r[l].length;a++)if(0===a||r[l][a]!=r[l][a-1]){var o=f(r[l][a]);if(1<parseInt(o.attr("rowspan"),10)){var i=parseInt(o.attr("rowspan"),10)-1;1==i?o.removeAttr("rowspan"):o.attr("rowspan",i)}if(l<r.length-1&&r[l][a]==r[l+1][a]&&(0===l||r[l][a]!=r[l-1][a])){for(var c=r[l][a],d=a;0<d&&r[l][d]==r[l][d-1];)d--;0===d?f(e.find("tr").not(e.find("> table tr")).get(l+1)).prepend(c):f(r[l+1][d-1])[0].parentNode&&f(r[l+1][d-1])[0].insertAdjacentElement("afterend",c)}}var p=n.parent();n.remove(),0===p.find("tr").length&&p.remove(),r=R(e)}C(0,r.length-1,0,r[0].length-1,e),0<s.min_i?t.selection.setAtEnd(r[s.min_i-1][0]):t.selection.setAtEnd(r[0][0]),t.selection.restore(),t.popups.hide("table.edit")}}},insertColumn:function(e){var l=Z();if(0<l.length){var a,n=R(),r=D(n);a="before"==e?r.min_j:r.max_j;var s,o=100/n[0].length,i=100/(n[0].length+1);l.find("th, td").each(function(){(s=f(this)).data("old-width",s.outerWidth()/l.outerWidth()*100)}),l.find("tr").not(l.find("> table tr")).each(function(t){for(var l,r=f(this),s=0,c=0;s-1<a;){if(!(l=r.find("> th, > td").get(c))){l=null;break}l==n[t][s]?(s+=parseInt(f(l).attr("colspan"),10)||1,c++):(s+=parseInt(f(n[t][s]).attr("colspan"),10)||1,"after"==e&&(l=0===c?-1:r.find("> th, > td").get(c-1)))}var d,p=f(l);if("after"==e&&a<s-1||"before"==e&&0<a&&n[t][a]==n[t][a-1]){if(0===t||0<t&&n[t][a]!=n[t-1][a]){var h=parseInt(p.attr("colspan"),10)+1;p.attr("colspan",h),p.css("width",(p.data("old-width")*i/o+i).toFixed(4)+"%"),p.removeData("old-width")}}else d=0<r.find("th").length?'<th style="width: '+i.toFixed(4)+'%;"><br></th>':'<td style="width: '+i.toFixed(4)+'%;"><br></td>',-1==l?r.prepend(d):null==l?r.append(d):"before"==e?p.before(d):"after"==e&&p[0].parentNode&&p[0].insertAdjacentHTML("afterend",d)}),l.find("th, td").each(function(){(s=f(this)).data("old-width")&&(s.css("width",(s.data("old-width")*i/o).toFixed(4)+"%"),s.removeData("old-width"))}),t.popups.isVisible("table.edit")&&c()}},deleteColumn:function(){var e=Z();if(0<e.length){var l,a,n,r=R(),s=D(r);if(null==s)return;if(0===s.min_j&&s.max_j==r[0].length-1)b();else{var o=0;for(l=0;l<r.length;l++)for(a=0;a<r[0].length;a++)(n=f(r[l][a])).hasClass("fr-selected-cell")||(n.data("old-width",n.outerWidth()/e.outerWidth()*100),(a<s.min_j||a>s.max_j)&&(o+=n.outerWidth()/e.outerWidth()*100));for(o/=r.length,a=s.max_j;a>=s.min_j;a--)for(l=0;l<r.length;l++)if(0===l||r[l][a]!=r[l-1][a])if(n=f(r[l][a]),1<(parseInt(n.attr("colspan"),10)||1)){var i=parseInt(n.attr("colspan"),10)-1;1==i?n.removeAttr("colspan"):n.attr("colspan",i),n.css("width",(100*(n.data("old-width")-P(a,r))/o).toFixed(4)+"%"),n.removeData("old-width")}else{var c=f(n.parent().get(0));n.remove(),0===c.find("> th, > td").length&&(0===c.prev().length||0===c.next().length||c.prev().find("> th[rowspan], > td[rowspan]").length<c.prev().find("> th, > td").length)&&c.remove()}C(0,r.length-1,0,r[0].length-1,e),0<s.min_j?t.selection.setAtEnd(r[s.min_i][s.min_j-1]):t.selection.setAtEnd(r[s.min_i][0]),t.selection.restore(),t.popups.hide("table.edit"),e.find("th, td").each(function(){(n=f(this)).data("old-width")&&(n.css("width",(100*n.data("old-width")/o).toFixed(4)+"%"),n.removeData("old-width"))})}}},mergeCells:function(){if(1<J().length&&(0===t.$el.find("th.fr-selected-cell").length||0===t.$el.find("td.fr-selected-cell").length)){x();var e,l,a=D(R());if(null==a)return;var n=t.$el.find(".fr-selected-cell"),r=f(n[0]),s=r.parent().find(".fr-selected-cell"),o=r.closest("table"),i=r.html(),d=0;for(e=0;e<s.length;e++)d+=f(s[e]).outerWidth();for(r.css("width",Math.min(100,d/o.outerWidth()*100).toFixed(4)+"%"),a.min_j<a.max_j&&r.attr("colspan",a.max_j-a.min_j+1),a.min_i<a.max_i&&r.attr("rowspan",a.max_i-a.min_i+1),e=1;e<n.length;e++)"<br>"!=(l=f(n[e])).html()&&""!==l.html()&&(i+="<br>"+l.html()),l.remove();r.html(i),t.selection.setAtEnd(r.get(0)),t.selection.restore(),t.toolbar.enable(),v(a.min_i,a.max_i,o);var p=o.find("tr:empty");for(e=p.length-1;0<=e;e--)f(p[e]).remove();m(a.min_j,a.max_j,o),c()}},splitCellVertically:function(){if(1==J().length){var e=t.$el.find(".fr-selected-cell"),l=parseInt(e.attr("colspan"),10)||1,a=e.parent().outerWidth(),n=e.outerWidth(),r=e.clone().html("<br>"),s=R(),o=O(e.get(0),s);if(1<l){var i=Math.ceil(l/2);n=j(o.col,o.col+i-1,s)/a*100;var c=j(o.col+i,o.col+l-1,s)/a*100;1<i?e.attr("colspan",i):e.removeAttr("colspan"),1<l-i?r.attr("colspan",l-i):r.removeAttr("colspan"),e.css("width",n.toFixed(4)+"%"),r.css("width",c.toFixed(4)+"%")}else{var d;for(d=0;d<s.length;d++)if(0===d||s[d][o.col]!=s[d-1][o.col]){var p=f(s[d][o.col]);if(!p.is(e)){var h=(parseInt(p.attr("colspan"),10)||1)+1;p.attr("colspan",h)}}n=n/a*100/2,e.css("width",n.toFixed(4)+"%"),r.css("width",n.toFixed(4)+"%")}e[0].parentNode&&e[0].insertAdjacentElement("afterend",r[0]),_(),t.popups.hide("table.edit")}},splitCellHorizontally:function(){if(1==J().length){var e=t.$el.find(".fr-selected-cell"),l=e.parent(),a=e.closest("table"),n=parseInt(e.attr("rowspan"),10),r=R(),s=O(e.get(0),r),o=e.clone().html("<br>");if(1<n){var i=Math.ceil(n/2);1<i?e.attr("rowspan",i):e.removeAttr("rowspan"),1<n-i?o.attr("rowspan",n-i):o.removeAttr("rowspan");for(var c=s.row+i,d=0===s.col?s.col:s.col-1;0<=d&&(r[c][d]==r[c][d-1]||0<c&&r[c][d]==r[c-1][d]);)d--;-1==d?f(a.find("tr").not(a.find("> table tr")).get(c)).prepend(o):f(r[c][d])[0].parentNode&&f(r[c][d])[0].insertAdjacentElement("afterend",o[0])}else{var p,h=f(document.createElement("tr")).append(o);for(p=0;p<r[0].length;p++)if(0===p||r[s.row][p]!=r[s.row][p-1]){var u=f(r[s.row][p]);u.is(e)||u.attr("rowspan",(parseInt(u.attr("rowspan"),10)||1)+1)}l[0].parentNode&&l[0].insertAdjacentElement("afterend",h[0])}_(),t.popups.hide("table.edit")}},addHeader:function(){var e=Z();if(0<e.length&&0===e.find("th").length){var t,l="<thead><tr>",a=0;for(e.find("tr").first().find("> td").each(function(){var e=f(this);a+=parseInt(e.attr("colspan"),10)||1}),t=0;t<a;t++)l+="<th><br></th>";l+="</tr></thead>",e.prepend(l),c()}},removeHeader:function(){var e=Z(),l=e.find("thead");if(0<l.length)if(0===e.find("tbody tr").length)b();else if(l.remove(),0<J().length)c();else{t.popups.hide("table.edit");var a=e.find("tbody tr").first().find("td").first().get(0);a&&(t.selection.setAtEnd(a),t.selection.restore())}},setBackground:E,showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertTable"]'),l=t.popups.get("table.insert");if(l||(l=p()),!l.hasClass("fr-active")){t.popups.refresh("table.insert"),t.popups.setContainer("table.insert",t.$tb);var a=t.button.getPosition(e),n=a.left,r=a.top;t.popups.show("table.insert",n,r,e.outerHeight())}},showEditPopup:c,showColorsPopup:function l(){var a=R();if(a){var n=t.popups.get("table.colors");n||(n=function(){var a="";0<t.opts.tableColorsButtons.length&&(a='<div class="fr-buttons fr-tabs">'+t.button.buildList(t.opts.tableColorsButtons)+"</div>");var n="";t.opts.colorsHEXInput&&(n='<div class="fr-color-hex-layer fr-table-colors-hex-layer fr-active fr-layer" id="fr-table-colors-hex-layer-'+t.id+'"><div class="fr-input-line"><input maxlength="7" id="fr-table-colors-hex-layer-text-'+t.id+'" type="text" placeholder="'+t.language.translate("HEX Color")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="tableCellBackgroundCustomColor" tabIndex="2" role="button">'+t.language.translate("OK")+"</button></div></div>");var r,s={buttons:a,colors:function(){for(var e='<div class="fr-color-set fr-table-colors">',l=0;l<t.opts.tableColors.length;l++)0!==l&&l%t.opts.tableColorsStep==0&&(e+="<br>"),"REMOVE"!=t.opts.tableColors[l]?e+='<span class="fr-command" style="background: '+t.opts.tableColors[l]+';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="'+t.opts.tableColors[l]+'"><span class="fr-sr-only">'+t.language.translate("Color")+" "+t.opts.tableColors[l]+"&nbsp;&nbsp;&nbsp;</span></span>":e+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'+t.language.translate("Clear Formatting")+'">'+t.icon.create("tableColorRemove")+'<span class="fr-sr-only">'+t.language.translate("Clear Formatting")+"</span></span>";return e+"</div>"}(),custom_color:n},o=t.popups.create("table.colors",s);return t.events.$on(t.$wp,"scroll.table-colors",function(){t.popups.isVisible("table.colors")&&l()}),r=o,t.events.on("popup.tab",function(l){var a=f(l.currentTarget);if(!t.popups.isVisible("table.colors")||!a.is("span"))return!0;var n=l.which,s=!0;if(e.KEYCODE.TAB==n){var o=r.find(".fr-buttons");s=!t.accessibility.focusToolbar(o,!!l.shiftKey)}else if(e.KEYCODE.ARROW_UP==n||e.KEYCODE.ARROW_DOWN==n||e.KEYCODE.ARROW_LEFT==n||e.KEYCODE.ARROW_RIGHT==n){var i=a.parent().find("span.fr-command"),c=i.index(a),d=t.opts.colorsStep,p=Math.floor(i.length/d),h=c%d,u=Math.floor(c/d)*d+h,b=p*d;e.KEYCODE.ARROW_UP==n?u=((u-d)%b+b)%b:e.KEYCODE.ARROW_DOWN==n?u=(u+d)%b:e.KEYCODE.ARROW_LEFT==n?u=((u-1)%b+b)%b:e.KEYCODE.ARROW_RIGHT==n&&(u=(u+1)%b);var g=f(i.get(u));t.events.disableBlur(),g.focus(),s=!1}else e.KEYCODE.ENTER==n&&(t.button.exec(a),s=!1);return!1===s&&(l.preventDefault(),l.stopPropagation()),s},!0),o}()),t.popups.setContainer("table.colors",t.$sc);var r=y(a),s=(r.left+r.right)/2,o=r.bottom;!function(){var e=t.popups.get("table.colors"),l=t.$el.find(".fr-selected-cell").first(),a=t.helpers.RGBToHex(l.css("background-color")),n=e.find(".fr-table-colors-hex-layer input");e.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),e.find('span[data-param1="'+a+'"]').addClass("fr-selected-color fr-active-item"),n.val(a).trigger("change")}(),t.popups.show("table.colors",s,o,r.bottom-r.top,!0)}},back:function(){0<J().length?c():(t.popups.hide("table.insert"),t.toolbar.showInline())},verticalAlign:function(e){t.$el.find(".fr-selected-cell").css("vertical-align",e)},horizontalAlign:function(e){t.$el.find(".fr-selected-cell").css("text-align",e)},applyStyle:function(e,t,l,a){if(0<t.length){if(!l){var n=Object.keys(a);n.splice(n.indexOf(e),1),t.removeClass(n.join(" "))}t.toggleClass(e)}},selectedTable:Z,selectedCells:J,customColor:function(){var e=t.popups.get("table.colors").find(".fr-table-colors-hex-layer input");e.length&&E(e.val())},selectCells:M}},e.DefineIcon("insertTable",{NAME:"table",SVG_KEY:"insertTable"}),e.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),e.RegisterCommand("tableInsert",{callback:function(e,t,l){this.table.insert(t,l),this.popups.hide("table.insert")}}),e.DefineIcon("tableHeader",{NAME:"header",FA5NAME:"heading",SVG_KEY:"tableHeader"}),e.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(e){var t=this.table.selectedTable();0<t.length&&(0===t.find("th").length?e.removeClass("fr-active").attr("aria-pressed",!1):e.addClass("fr-active").attr("aria-pressed",!0))}}),e.DefineIcon("tableRows",{NAME:"bars",SVG_KEY:"row"}),e.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below",delete:"Delete row"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',l=e.COMMANDS.tableRows.options;for(var a in l)l.hasOwnProperty(a)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+a+'" title="'+this.language.translate(l[a])+'">'+this.language.translate(l[a])+"</a></li>");return t+"</ul>"},callback:function(e,t){"above"==t||"below"==t?this.table.insertRow(t):this.table.deleteRow()}}),e.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90",SVG_KEY:"columns"}),e.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after",delete:"Delete column"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',l=e.COMMANDS.tableColumns.options;for(var a in l)l.hasOwnProperty(a)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'+a+'" title="'+this.language.translate(l[a])+'">'+this.language.translate(l[a])+"</a></li>");return t+"</ul>"},callback:function(e,t){"before"==t||"after"==t?this.table.insertColumn(t):this.table.deleteColumn()}}),e.DefineIcon("tableCells",{NAME:"square-o",FA5NAME:"square",SVG_KEY:"cellOptions"}),e.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',l=e.COMMANDS.tableCells.options;for(var a in l)l.hasOwnProperty(a)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'+a+'" title="'+this.language.translate(l[a])+'">'+this.language.translate(l[a])+"</a></li>");return t+"</ul>"},callback:function(e,t){"merge"==t?this.table.mergeCells():"vertical-split"==t?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(e,t){1<this.$el.find(".fr-selected-cell").length?(t.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):(t.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),t.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),e.DefineIcon("tableRemove",{NAME:"trash",SVG_KEY:"removeTable"}),e.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),e.DefineIcon("tableStyle",{NAME:"paint-brush",SVG_KEY:"tableStyle"}),e.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableStyles;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(e,t){var l=this.$,a=this.$el.find(".fr-selected-cell").closest("table");a&&t.find(".fr-command").each(function(){var e=l(this).data("param1"),t=a.hasClass(e);l(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.DefineIcon("tableCellBackground",{NAME:"tint",SVG_KEY:"cellBackground"}),e.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),e.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(e,t){this.table.setBackground(t)}}),e.DefineIcon("tableBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(e){0!==this.table.selectedCells().length||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v",FA5NAME:"arrows-alt-v",SVG_KEY:"verticalAlignMiddle"}),e.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',l=e.COMMANDS.tableCellVerticalAlign.options;for(var a in l)l.hasOwnProperty(a)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'+a.toLowerCase()+'" title="'+this.language.translate(l[a])+'">'+this.language.translate(a)+"</a></li>");return t+"</ul>"},callback:function(e,t){this.table.verticalAlign(t)},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),e.DefineIcon("align-center",{NAME:"align-center",SVG_KEY:"alignCenter"}),e.DefineIcon("align-justify",{NAME:"align-justify",SVG_KEY:"alignJustify"}),e.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',l=e.COMMANDS.tableCellHorizontalAlign.options;for(var a in l)l.hasOwnProperty(a)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'+a+'" title="'+this.language.translate(l[a])+'">'+this.icon.create("align-"+a)+'<span class="fr-sr-only">'+this.language.translate(l[a])+"</span></a></li>");return t+"</ul>"},callback:function(e,t){this.table.horizontalAlign(t)},refresh:function(e){var t=this.table.selectedCells(),l=this.$;t.length&&e.find("> *").first().replaceWith(this.icon.create("align-"+this.helpers.getAlignment(l(t[0]))))},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell").first())+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.DefineIcon("tableCellStyle",{NAME:"magic",SVG_KEY:"cellStyle"}),e.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableCellStyles;for(var l in t)t.hasOwnProperty(l)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'+l+'" title="'+this.language.translate(t[l])+'">'+this.language.translate(t[l])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(e,t){var l=this.$,a=this.$el.find(".fr-selected-cell").first();a&&t.find(".fr-command").each(function(){var e=l(this).data("param1"),t=a.hasClass(e);l(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.RegisterCommand("tableCellBackgroundCustomColor",{title:"OK",undo:!0,callback:function(){this.table.customColor()}}),e.DefineIcon("tableColorRemove",{NAME:"eraser",SVG_KEY:"remove"})});