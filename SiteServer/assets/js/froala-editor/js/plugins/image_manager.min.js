!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],a):a(e.FroalaEditor)}(this,function(e){"use strict";if(e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.DEFAULTS,{imageManagerLoadURL:"https://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:null,imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),e.PLUGINS.imageManager=function(a){var t,r,i,n,o,s,g,l,d,m,f,c=a.$,u="image_manager",p=10,h=14,v=15,M=21,b=22,w={};function C(){var e=c(window).outerWidth();return e<768?2:e<1200?3:4}function L(){o.empty();for(var e=0;e<f;e++)o.append('<div class="fr-list-column"></div>')}function D(){if(d<g.length&&(o.outerHeight()<=i.outerHeight()+a.opts.imageManagerScrollOffset||i.scrollTop()+a.opts.imageManagerScrollOffset>o.outerHeight()-i.outerHeight())){l++;for(var e=a.opts.imageManagerPageSize*(l-1);e<Math.min(g.length,a.opts.imageManagerPageSize*l);e++)y(g[e])}}function y(e){var t=new Image,i=c(document.createElement("div")).attr("class","fr-image-container fr-empty fr-image-"+m++).attr("data-loading",a.language.translate("Loading")+"..").attr("data-deleting",a.language.translate("Deleting")+"..");T(!1),t.onload=function(){i.height(Math.floor(i.width()/t.width*t.height));var n=c(document.createElement("img"));if(e.thumb)n.attr("src",e.thumb);else{if(x(h,e),!e.url)return x(v,e),!1;n.attr("src",e.url)}if(e.url&&n.attr("data-url",e.url),e.tag)if(r.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),r.find(".fr-modal-tags").show(),0<=e.tag.indexOf(",")){for(var o=e.tag.split(","),g=0;g<o.length;g++)o[g]=o[g].trim(),0===s.find('a[title="'+o[g]+'"]').length&&s.append('<a role="button" title="'+o[g]+'">'+o[g]+"</a>");n.attr("data-tag",o.join())}else 0===s.find('a[title="'+e.tag.trim()+'"]').length&&s.append('<a role="button" title="'+e.tag.trim()+'">'+e.tag.trim()+"</a>"),n.attr("data-tag",e.tag.trim());for(var l in e.name&&n.attr("alt",e.name),e)e.hasOwnProperty(l)&&"thumb"!==l&&"url"!==l&&"tag"!==l&&n.attr("data-"+l,e[l]);i.append(n).append(c(a.icon.create("imageManagerDelete")).addClass("fr-delete-img").attr("title",a.language.translate("Delete"))).append(c(a.icon.create("imageManagerInsert")).addClass("fr-insert-img").attr("title",a.language.translate("Insert"))),s.find(".fr-selected-tag").each(function(e,a){_(n,a.text)||i.hide()}),n.on("load",function(){i.removeClass("fr-empty"),i.height("auto"),d++,S(I(parseInt(n.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1)),T(!1),d%a.opts.imageManagerPageSize==0&&D()}),a.events.trigger("imageManager.imageLoaded",[n])},t.onerror=function(){d++,i.remove(),S(I(parseInt(i.attr("class").match(/fr-image-(\d+)/)[1],10)+1)),x(p,e),d%a.opts.imageManagerPageSize==0&&D()},t.src=e.thumb||e.url,P().append(i)}function P(){var e,a;return o.find(".fr-list-column").each(function(t,r){var i=c(r);0===t?(a=i.outerHeight(),e=i):i.outerHeight()<a&&(a=i.outerHeight(),e=i)}),e}function I(e){void 0===e&&(e=0);for(var a=[],t=m-1;e<=t;t--){var r=o.find(".fr-image-"+t);r.length&&(a.push(r),c(document.createElement("div")).attr("id","fr-image-hidden-container").append(r),o.find(".fr-image-"+t).remove())}return a}function S(e){for(var a=e.length-1;0<=a;a--)P().append(e[a])}function T(e){if(void 0===e&&(e=!0),!t.isVisible())return!0;var r=C();if(r!==f){f=r;var i=I();L(),S(i)}a.modals.resize(u),e&&D()}function E(e){var a={},t=e.data();for(var r in t)t.hasOwnProperty(r)&&"url"!==r&&"tag"!==r&&(a[r]=t[r]);return a}function R(e){var r=c(e.currentTarget).siblings("img"),i=t.data("instance")||a,n=t.data("current-image");if(a.modals.hide(u),i.image.showProgressBar(),n)n.data("fr-old-src",n.attr("src")),n.trigger("click");else{i.events.focus(!0),i.selection.restore();var o=i.position.getBoundingRect(),s=o.left+o.width/2+c(a.doc).scrollLeft(),g=o.top+o.height+c(a.doc).scrollTop();i.popups.setContainer("image.insert",a.$sc),i.popups.show("image.insert",s,g)}i.image.insert(r.data("url"),!1,E(r),n)}function U(e){var r=c(e.currentTarget).siblings("img"),i=a.language.translate("Are you sure? Image will be deleted.");confirm(i)&&(a.opts.imageManagerDeleteURL?!1!==a.events.trigger("imageManager.beforeDeleteImage",[r])&&(r.parent().addClass("fr-image-deleting"),c(this).ajax({method:a.opts.imageManagerDeleteMethod,url:a.opts.imageManagerDeleteURL,data:Object.assign(Object.assign({src:r.attr("src")},E(r)),a.opts.imageManagerDeleteParams),crossDomain:a.opts.requestWithCORS,withCredentials:a.opts.requestWithCredentials,headers:a.opts.requestHeaders,done:function(e,i,n){a.events.trigger("imageManager.imageDeleted",[e]);var o=I(parseInt(r.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);r.parent().remove(),S(o),t.find("#fr-modal-tags > a").each(function(){0===t.find('#fr-image-list [data-tag*="'+c(this).text()+'"]').length&&c(this).removeClass("fr-selected-tag").hide()}),O(),T(!0)},fail:function(e){x(M,e.response||e.responseText)}})):x(b))}function x(e,t){10<=e&&e<20?n.hide():20<=e&&e<30&&c(".fr-image-deleting").removeClass("fr-image-deleting"),a.events.trigger("imageManager.error",[{code:e,message:w[e]},t])}function H(){var e=r.find(".fr-modal-head-line").outerHeight(),a=s.outerHeight();r.toggleClass("fr-show-tags"),r.hasClass("fr-show-tags")?(r.css("height",e+a),i.css("marginTop",e+a),s.find("a").css("opacity",1)):(r.css("height",e),i.css("marginTop",e),s.find("a").css("opacity",0))}function O(){var e=s.find(".fr-selected-tag");0<e.length?(o.find("img").parents().show(),e.each(function(e,a){o.find("img").each(function(e,t){var r=c(t);_(r,a.text)||r.parent().hide()})})):o.find("img").parents().show(),S(I()),D()}function q(e){e.preventDefault();var t=c(e.currentTarget);t.toggleClass("fr-selected-tag"),a.opts.imageManagerToggleTags&&t.siblings("a").removeClass("fr-selected-tag"),O()}function _(e,a){for(var t=(e.attr("data-tag")||"").split(","),r=0;r<t.length;r++)if(t[r]===a)return!0;return!1}return w[p]="Image cannot be loaded from the passed link.",w[11]="Error during load images request.",w[12]="Missing imageManagerLoadURL option.",w[13]="Parsing load response failed.",w[h]="Missing image thumb.",w[v]="Missing image URL.",w[M]="Error during delete image request.",w[b]="Missing imageManagerDeleteURL option.",{require:["image"],_init:function(){if(!a.$wp&&"IMG"!==a.el.tagName)return!1},show:function(){if(!t){var p,h='<button class="fr-command fr-btn fr-modal-more fr-not-available" id="fr-modal-more-'.concat(a.sid,'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24""><path d="').concat(e.SVG.tags,'"/></svg></button><h4 data-text="true">').concat(a.language.translate("Manage Images"),'</h4></div>\n      <div class="fr-modal-tags" id="fr-modal-tags">');p=a.opts.imageManagerPreloader?'<img class="fr-preloader" id="fr-preloader" alt="'+a.language.translate("Loading")+'.." src="'+a.opts.imageManagerPreloader+'" style="display: none;">':'<span class="fr-preloader" id="fr-preloader" style="display: none;">'+a.language.translate("Loading")+"</span>",p+='<div class="fr-image-list" id="fr-image-list"></div>';var v=a.modals.create(u,h,p);t=v.$modal,r=v.$head,i=v.$body}t.data("current-image",a.image.get()),a.modals.show(u),n||(n=t.find("#fr-preloader"),o=t.find("#fr-image-list"),s=t.find("#fr-modal-tags"),f=C(),L(),r.css("height",r.find(".fr-modal-head-line").outerHeight()),a.events.$on(c(a.o_win),"resize",function(){T(!!g)}),a.events.bindClick(o,".fr-insert-img",R),a.events.bindClick(o,".fr-delete-img",U),a.helpers.isMobile()&&(a.events.bindClick(o,"div.fr-image-container",function(e){t.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),c(e.currentTarget).addClass("fr-mobile-selected")}),t.on(a._mousedown,function(){t.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),t.on(a._mousedown+" "+a._mouseup,function(e){e.stopPropagation()}),t.on(a._mousedown,"*",function(){a.events.disableBlur()}),i.on("scroll",D),a.events.bindClick(t,"button#fr-modal-more-"+a.sid,H),a.events.bindClick(s,"a",q)),function(){n.show(),o.find(".fr-list-column").empty(),a.opts.imageManagerLoadURL?c(this).ajax({url:a.opts.imageManagerLoadURL,method:a.opts.imageManagerLoadMethod,data:a.opts.imageManagerLoadParams,dataType:"json",crossDomain:a.opts.requestWithCORS,withCredentials:a.opts.requestWithCredentials,headers:a.opts.requestHeaders,done:function(e,t,r){a.events.trigger("imageManager.imagesLoaded",[e]),function(e,a){try{o.find(".fr-list-column").empty(),m=d=l=0,g=e,D()}catch(e){x(13,a)}}(e,r.response),n.hide()},fail:function(e){x(11,e.response||e.responseText)}}):x(12)}()},hide:function(){a.modals.hide(u)}}},!e.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");e.DEFAULTS.imageInsertButtons.push("imageManager"),e.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,modal:!0,callback:function(){this.imageManager.show()},plugin:"imageManager"}),e.DefineIcon("imageManager",{NAME:"folder",SVG_KEY:"imageManager"}),e.DefineIcon("imageManagerInsert",{NAME:"plus",SVG_KEY:"add"}),e.DefineIcon("imageManagerDelete",{NAME:"trash",SVG_KEY:"remove"})});