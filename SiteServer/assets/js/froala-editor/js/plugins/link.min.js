!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.POPUP_TEMPLATES,{"link.edit":"[_BUTTONS_]","link.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),Object.assign(e.DEFAULTS,{linkEditButtons:["linkOpen","linkStyle","linkEdit","linkRemove"],linkInsertButtons:["linkBack","|","linkList"],linkAttributes:{},linkAutoPrefix:"http://",linkStyles:{"fr-green":"Green","fr-strong":"Thick"},linkMultipleStyles:!0,linkConvertEmailAddress:!0,linkAlwaysBlank:!1,linkAlwaysNoFollow:!1,linkNoOpener:!0,linkNoReferrer:!0,linkList:[{text:"Froala",href:"https://froala.com",target:"_blank"},{text:"Google",href:"https://google.com",target:"_blank"},{displayText:"Facebook",href:"https://facebook.com"}],linkText:!0}),e.PLUGINS.link=function(t){var n=t.$;function i(){var e=t.image?t.image.get():null;if(e||!t.$wp)return"A"==t.el.tagName?t.el:e&&e.get(0).parentNode&&"A"==e.get(0).parentNode.tagName?e.get(0).parentNode:void 0;var i=t.selection.ranges(0).commonAncestorContainer;try{i&&(i.contains&&i.contains(t.el)||!t.el.contains(i)||t.el==i)&&(i=null)}catch(e){i=null}if(i&&"A"===i.tagName)return i;var r=t.selection.element(),l=t.selection.endElement();"A"==r.tagName||t.node.isElement(r)||(r=n(r).parentsUntil(t.$el,"a").first().get(0)),"A"==l.tagName||t.node.isElement(l)||(l=n(l).parentsUntil(t.$el,"a").first().get(0));try{l&&(l.contains&&l.contains(t.el)||!t.el.contains(l)||t.el==l)&&(l=null)}catch(e){l=null}try{r&&(r.contains&&r.contains(t.el)||!t.el.contains(r)||t.el==r)&&(r=null)}catch(e){r=null}return l&&l==r&&"A"==l.tagName?(t.browser.msie||t.helpers.isMobile())&&(t.selection.info(r).atEnd||t.selection.info(r).atStart)?null:r:null}function r(){var e,n,i,r,l=t.image?t.image.get():null,a=[];if(l)"A"==l.get(0).parentNode.tagName&&a.push(l.get(0).parentNode);else if(t.win.getSelection){var s=t.win.getSelection();if(s.getRangeAt&&s.rangeCount){r=t.doc.createRange();for(var o=0;o<s.rangeCount;++o)if((n=(e=s.getRangeAt(o)).commonAncestorContainer)&&1!=n.nodeType&&(n=n.parentNode),n&&"a"==n.nodeName.toLowerCase())a.push(n);else{i=n.getElementsByTagName("a");for(var p=0;p<i.length;++p)r.selectNodeContents(i[p]),r.compareBoundaryPoints(e.END_TO_START,e)<1&&-1<r.compareBoundaryPoints(e.START_TO_END,e)&&a.push(i[p])}}}else if(t.doc.selection&&"Control"!=t.doc.selection.type)if("a"==(n=(e=t.doc.selection.createRange()).parentElement()).nodeName.toLowerCase())a.push(n);else{i=n.getElementsByTagName("a"),r=t.doc.body.createTextRange();for(var f=0;f<i.length;++f)r.moveToElementText(i[f]),-1<r.compareEndPoints("StartToEnd",e)&&r.compareEndPoints("EndToStart",e)<1&&a.push(i[f])}return a}function l(r){if(t.core.hasFocus()){if(a(),r&&"keyup"===r.type&&(r.altKey||r.which==e.KEYCODE.ALT))return!0;setTimeout(function(){if(!r||r&&(1==r.which||"mouseup"!=r.type)){var l=i(),a=t.image?t.image.get():null;if(l&&!a){if(t.image){var s=t.node.contents(l);if(1==s.length&&"IMG"==s[0].tagName){var o=t.selection.ranges(0);return 0===o.startOffset&&0===o.endOffset?n(l).before(e.MARKERS):n(l).after(e.MARKERS),t.selection.restore(),!1}}r&&r.stopPropagation(),function e(r){var l=t.popups.get("link.edit");l||(l=function(){var n="";1<=t.opts.linkEditButtons.length&&("A"==t.el.tagName&&0<=t.opts.linkEditButtons.indexOf("linkRemove")&&t.opts.linkEditButtons.splice(t.opts.linkEditButtons.indexOf("linkRemove"),1),n='<div class="fr-buttons">'.concat(t.button.buildList(t.opts.linkEditButtons),"</div>"));var r={buttons:n},l=t.popups.create("link.edit",r);return t.$wp&&t.events.$on(t.$wp,"scroll.link-edit",function(){i()&&t.popups.isVisible("link.edit")&&e(i())}),l}());var a=n(r);t.popups.isVisible("link.edit")||t.popups.refresh("link.edit"),t.popups.setContainer("link.edit",t.$sc);var s=a.offset().left+a.outerWidth()/2,o=a.offset().top+a.outerHeight();t.popups.show("link.edit",s,o,a.outerHeight(),!0)}(l)}}},t.helpers.isIOS()?100:0)}}function a(){t.popups.hide("link.edit")}function s(){var e=t.popups.get("link.insert"),r=i();if(r){var l,a,s=n(r),o=e.find('input.fr-link-attr[type="text"]'),p=e.find('input.fr-link-attr[type="checkbox"]');for(l=0;l<o.length;l++)(a=n(o[l])).val(s.attr(a.attr("name")||""));for(p.attr("checked",!1),l=0;l<p.length;l++)a=n(p[l]),s.attr(a.attr("name"))==a.data("checked")&&a.attr("checked",!0);e.find('input.fr-link-attr[type="text"][name="text"]').val(s.text())}else e.find('input.fr-link-attr[type="text"]').val(""),e.find('input.fr-link-attr[type="checkbox"]').attr("checked",!1),e.find('input.fr-link-attr[type="text"][name="text"]').val(t.selection.text());e.find("input.fr-link-attr").trigger("change"),t.image&&t.image.get()?e.find('.fr-link-attr[name="text"]').parent().hide():e.find('.fr-link-attr[name="text"]').parent().show()}function o(e){if(e)return t.popups.onRefresh("link.insert",s),!0;var n="";1<=t.opts.linkInsertButtons.length&&(n='<div class="fr-buttons fr-tabs">'+t.button.buildList(t.opts.linkInsertButtons)+"</div>");var i="",r=0;for(var l in i='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+t.id+'">',i+='<div class="fr-input-line"><input id="fr-link-insert-layer-url-'+t.id+'" name="href" type="text" class="fr-link-attr" placeholder="'+t.language.translate("URL")+'" tabIndex="'+ ++r+'"></div>',t.opts.linkText&&(i+='<div class="fr-input-line"><input id="fr-link-insert-layer-text-'+t.id+'" name="text" type="text" class="fr-link-attr" placeholder="'+t.language.translate("Text")+'" tabIndex="'+ ++r+'"></div>'),t.opts.linkAttributes)if(t.opts.linkAttributes.hasOwnProperty(l)){var a=t.opts.linkAttributes[l];i+='<div class="fr-input-line"><input name="'+l+'" type="text" class="fr-link-attr" placeholder="'+t.language.translate(a)+'" tabIndex="'+ ++r+'"></div>'}t.opts.linkAlwaysBlank||(i+='<div class="fr-checkbox-line"><span class="fr-checkbox"><input name="target" class="fr-link-attr" data-checked="_blank" type="checkbox" id="fr-link-target-'.concat(t.id,'" tabIndex="').concat(++r,'"><span>').concat('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32"><path d="M27 4l-15 15-7-7-5 5 12 12 20-20z" fill="#FFF"></path></svg>','</span></span><label id="fr-label-target-').concat(t.id,'">').concat(t.language.translate("Open in new tab"),"</label></div>"));var o={buttons:n,input_layer:i+='<div class="fr-action-buttons"><button class="fr-command fr-submit" role="button" data-cmd="linkInsert" href="#" tabIndex="'+ ++r+'" type="button">'+t.language.translate("Insert")+"</button></div></div>"},p=t.popups.create("link.insert",o);return t.$wp&&t.events.$on(t.$wp,"scroll.link-insert",function(){(t.image?t.image.get():null)&&t.popups.isVisible("link.insert")&&c(),t.popups.isVisible("link.insert")&&f()}),p}function p(a,s,o){if(void 0===o&&(o={}),!1===t.events.trigger("link.beforeInsert",[a,s,o]))return!1;var p=t.image?t.image.get():null;p||"A"==t.el.tagName?"A"==t.el.tagName&&t.$el.focus():(t.selection.restore(),t.popups.hide("link.insert"));var f=a;if(t.opts.linkConvertEmailAddress&&t.helpers.isEmail(a)&&!/^mailto:.*/i.test(a)&&(a="mailto:"+a),""===t.opts.linkAutoPrefix||new RegExp("^("+e.LinkProtocols.join("|")+"):.","i").test(a)||/^data:image.*/i.test(a)||/^(https?:|ftps?:|file:|)\/\//i.test(a)||/^([A-Za-z]:(\\){1,2}|[A-Za-z]:((\\){1,2}[^\\]+)+)(\\)?$/i.test(a)||["/","{","[","#","(","."].indexOf((a||"")[0])<0&&(a=t.opts.linkAutoPrefix+t.helpers.sanitizeURL(a)),a=t.helpers.sanitizeURL(a),t.opts.linkAlwaysBlank&&(o.target="_blank"),t.opts.linkAlwaysNoFollow&&(o.rel="nofollow"),t.helpers.isEmail(f)&&(o.target=null,o.rel=null),"_blank"==o.target?(t.opts.linkNoOpener&&(o.rel?o.rel+=" noopener":o.rel="noopener"),t.opts.linkNoReferrer&&(o.rel?o.rel+=" noreferrer":o.rel="noreferrer")):null==o.target&&(o.rel?o.rel=o.rel.replace(/noopener/,"").replace(/noreferrer/,""):o.rel=null),s=s||"",a===t.opts.linkAutoPrefix)return t.popups.get("link.insert").find('input[name="href"]').addClass("fr-error"),t.events.trigger("link.bad",[f]),!1;var c,d=i();if(d){if((c=n(d)).attr("href",a),0<s.length&&c.text()!=s&&!p){for(var u=c.get(0);1===u.childNodes.length&&u.childNodes[0].nodeType==Node.ELEMENT_NODE;)u=u.childNodes[0];n(u).text(s)}p||c.prepend(e.START_MARKER).append(e.END_MARKER),c.attr(o),p||t.selection.restore()}else{p?(p.wrap('<a href="'+a+'"></a>'),t.image.hasCaption()&&p.parent().append(p.parents(".fr-img-caption").find(".fr-inner"))):(t.format.remove("a"),t.selection.isCollapsed()?(s=0===s.length?f:s,t.html.insert('<a href="'+a+'">'+e.START_MARKER+s.replace(/&/g,"&amp;").replace(/</,"&lt;",">","&gt;")+e.END_MARKER+"</a>"),t.selection.restore()):0<s.length&&s!=t.selection.text().replace(/\n/g,"")?(t.selection.remove(),t.html.insert('<a href="'+a+'">'+e.START_MARKER+s.replace(/&/g,"&amp;")+e.END_MARKER+"</a>"),t.selection.restore()):(function(){if(!t.selection.isCollapsed()){t.selection.save();for(var e=t.$el.find(".fr-marker").addClass("fr-unprocessed").toArray();e.length;){var i=n(e.pop());i.removeClass("fr-unprocessed");var r=t.node.deepestParent(i.get(0));if(r){for(var l=i.get(0),a="",s="";l=l.parentNode,t.node.isBlock(l)||(a+=t.node.closeTagString(l),s=t.node.openTagString(l)+s),l!=r;);var o=t.node.openTagString(i.get(0))+i.html()+t.node.closeTagString(i.get(0));i.replaceWith('<span id="fr-break"></span>');var p=r.outerHTML;p=(p=p.replace(/<span id="fr-break"><\/span>/g,a+o+s)).replace(s+a,""),r.outerHTML=p}e=t.$el.find(".fr-marker.fr-unprocessed").toArray()}t.html.cleanEmptyTags(),t.selection.restore()}}(),t.format.apply("a",{href:a})));for(var k=r(),g=0;g<k.length;g++)(c=n(k[g])).attr(o),c.removeAttr("_moz_dirty");1==k.length&&t.$wp&&!p&&(n(k[0]).prepend(e.START_MARKER).append(e.END_MARKER),t.selection.restore())}if(p){var h=t.popups.get("link.insert");h&&h.find("input:focus").blur(),t.image.edit(p)}else l()}function f(){a();var e=i();if(e){var r=t.popups.get("link.insert");r||(r=o()),t.popups.isVisible("link.insert")||(t.popups.refresh("link.insert"),t.selection.save(),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur())),t.popups.setContainer("link.insert",t.$sc);var l=(t.image?t.image.get():null)||n(e),s=l.offset().left+l.outerWidth()/2,p=l.offset().top+l.outerHeight();t.popups.show("link.insert",s,p,l.outerHeight(),!0)}}function c(){var e=t.image?t.image.getEl():null;if(e){var n=t.popups.get("link.insert");t.image.hasCaption()&&(e=e.find(".fr-img-wrap")),n||(n=o()),s(),t.popups.setContainer("link.insert",t.$sc);var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+e.outerHeight();t.popups.show("link.insert",i,r,e.outerHeight(),!0)}}return{_init:function(){t.events.on("keyup",function(t){t.which!=e.KEYCODE.ESC&&l(t)}),t.events.on("window.mouseup",l),t.events.$on(t.$el,"click","a",function(e){t.edit.isDisabled()&&e.preventDefault()}),t.helpers.isMobile()&&t.events.$on(t.$doc,"selectionchange",l),o(!0),"A"==t.el.tagName&&t.$el.addClass("fr-view"),t.events.on("toolbar.esc",function(){if(t.popups.isVisible("link.edit"))return t.events.disableBlur(),t.events.focus(),!1},!0)},remove:function(){var e=i(),r=t.image?t.image.get():null;if(!1===t.events.trigger("link.beforeRemove",[e]))return!1;r&&e?(r.unwrap(),t.image.edit(r)):e&&(t.selection.save(),n(e).replaceWith(n(e).html()),t.selection.restore(),a())},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertLink"]'),n=t.popups.get("link.insert");if(n||(n=o()),!n.hasClass("fr-active"))if(t.popups.refresh("link.insert"),t.popups.setContainer("link.insert",t.$tb||t.$sc),e.isVisible()){var i=t.button.getPosition(e),r=i.left,l=i.top;t.popups.show("link.insert",r,l,e.outerHeight())}else t.position.forSelection(n),t.popups.show("link.insert")},usePredefined:function(e){var i,r,l=t.opts.linkList[e],a=t.popups.get("link.insert"),s=a.find('input.fr-link-attr[type="text"]'),o=a.find('input.fr-link-attr[type="checkbox"]');for(l.rel&&(a.rel=l.rel),r=0;r<s.length;r++)l[(i=n(s[r])).attr("name")]?(i.val(l[i.attr("name")]),i.toggleClass("fr-not-empty",!0)):"text"!=i.attr("name")&&i.val("");for(r=0;r<o.length;r++)(i=n(o[r])).attr("checked",i.data("checked")==l[i.attr("name")]);t.accessibility.focusPopup(a)},insertCallback:function(){var e,i,r=t.popups.get("link.insert"),l=r.find('input.fr-link-attr[type="text"]'),a=r.find('input.fr-link-attr[type="checkbox"]'),s=(l.filter('[name="href"]').val()||"").trim(),o=l.filter('[name="text"]').val(),f={};for(i=0;i<l.length;i++)e=n(l[i]),["href","text"].indexOf(e.attr("name"))<0&&(f[e.attr("name")]=e.val());for(i=0;i<a.length;i++)(e=n(a[i])).is(":checked")?f[e.attr("name")]=e.data("checked"):f[e.attr("name")]=e.data("unchecked")||null;r.rel&&(f.rel=r.rel);var c=t.helpers.scrollTop();p(s,o,f),n(t.o_win).scrollTop(c)},insert:p,update:f,get:i,allSelected:r,back:function(){t.image&&t.image.get()?t.image.back():(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),i()&&t.$wp?(t.selection.restore(),a(),l()):"A"==t.el.tagName?(t.$el.focus(),l()):(t.popups.hide("link.insert"),t.toolbar.showInline()))},imageLink:c,applyStyle:function(e,r,a){void 0===a&&(a=t.opts.linkMultipleStyles),void 0===r&&(r=t.opts.linkStyles);var s=i();if(!s)return!1;if(!a){var o=Object.keys(r);o.splice(o.indexOf(e),1),n(s).removeClass(o.join(" "))}n(s).toggleClass(e),l()}}},e.DefineIcon("insertLink",{NAME:"link",SVG_KEY:"insertLink"}),e.RegisterShortcut(e.KEYCODE.K,"insertLink",null,"K"),e.RegisterCommand("insertLink",{title:"Insert Link",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("link.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("link.insert")):this.link.showInsertPopup()},plugin:"link"}),e.DefineIcon("linkOpen",{NAME:"external-link",FA5NAME:"external-link-alt",SVG_KEY:"openLink"}),e.RegisterCommand("linkOpen",{title:"Open Link",undo:!1,refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")},callback:function(){var e=this.link.get();e&&(-1!==e.href.indexOf("mailto:")?this.o_win.open(e.href).close():this.o_win.open(e.href,"_blank","noopener"),this.popups.hide("link.edit"))},plugin:"link"}),e.DefineIcon("linkEdit",{NAME:"edit",SVG_KEY:"editLink"}),e.RegisterCommand("linkEdit",{title:"Edit Link",undo:!1,refreshAfterCallback:!1,popup:!0,callback:function(){this.link.update()},refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")},plugin:"link"}),e.DefineIcon("linkRemove",{NAME:"unlink",SVG_KEY:"unlink"}),e.RegisterCommand("linkRemove",{title:"Unlink",callback:function(){this.link.remove()},refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")},plugin:"link"}),e.DefineIcon("linkBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("linkBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.link.back()},refresh:function(e){var t=this.link.get()&&this.doc.hasFocus();this.image&&this.image.get()||t||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))},plugin:"link"}),e.DefineIcon("linkList",{NAME:"search",SVG_KEY:"search"}),e.RegisterCommand("linkList",{title:"Choose Link",type:"dropdown",focus:!1,undo:!1,refreshAfterCallback:!1,html:function(){for(var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.linkList,n=0;n<t.length;n++)e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkList" data-param1="'+n+'">'+(t[n].displayText||t[n].text)+"</a></li>";return e+"</ul>"},callback:function(e,t){this.link.usePredefined(t)},plugin:"link"}),e.RegisterCommand("linkInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.link.insertCallback()},refresh:function(e){this.link.get()?e.text(this.language.translate("Update")):e.text(this.language.translate("Insert"))},plugin:"link"}),e.DefineIcon("imageLink",{NAME:"link",SVG_KEY:"insertLink"}),e.RegisterCommand("imageLink",{title:"Insert Link",undo:!1,focus:!1,popup:!0,callback:function(){this.link.imageLink()},refresh:function(e){var t;this.link.get()?((t=e.prev()).hasClass("fr-separator")&&t.removeClass("fr-hidden"),e.addClass("fr-hidden")):((t=e.prev()).hasClass("fr-separator")&&t.addClass("fr-hidden"),e.removeClass("fr-hidden"))},plugin:"link"}),e.DefineIcon("linkStyle",{NAME:"magic",SVG_KEY:"linkStyles"}),e.RegisterCommand("linkStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.linkStyles;for(var n in t)t.hasOwnProperty(n)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkStyle" data-param1="'+n+'">'+this.language.translate(t[n])+"</a></li>");return e+"</ul>"},callback:function(e,t){this.link.applyStyle(t)},refreshOnShow:function(e,t){var n=this.$,i=this.link.get();if(i){var r=n(i);t.find(".fr-command").each(function(){var e=n(this).data("param1"),t=r.hasClass(e);n(this).toggleClass("fr-active",t).attr("aria-selected",t)})}},refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")},plugin:"link"})});