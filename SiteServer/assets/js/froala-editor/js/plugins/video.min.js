!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,Object.assign(e.POPUP_TEMPLATES,{"video.insert":"[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_][_UPLOAD_LAYER_][_PROGRESS_BAR_]","video.edit":"[_BUTTONS_]","video.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Object.assign(e.DEFAULTS,{videoAllowedTypes:["mp4","webm","ogg"],videoAllowedProviders:[".*"],videoDefaultAlign:"center",videoDefaultDisplay:"block",videoDefaultWidth:600,videoEditButtons:["videoReplace","videoRemove","videoDisplay","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoByURL","videoEmbed","videoUpload"],videoMaxSize:52428800,videoMove:!0,videoResize:!0,videoResponsive:!1,videoSizeButtons:["videoBack","|"],videoSplitHTML:!1,videoTextNear:!0,videoUpload:!0,videoUploadMethod:"POST",videoUploadParam:"file",videoUploadParams:{},videoUploadToS3:!1,videoUploadURL:null}),e.VIDEO_PROVIDERS=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"https://www.youtube.com/embed/$1?$2",html:'<iframe width="640" height="360" src="{url}&wmode=opaque" frameborder="0" allowfullscreen></iframe>',provider:"youtube"},{test_regex:/^.*(?:vimeo.com)\/(?:channels(\/\w+\/)?|groups\/*\/videos\/\u200b\d+\/|video\/|)(\d+)(?:$|\/|\?)/,url_regex:/(?:https?:\/\/)?(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?(\/[a-zA-Z0-9_\-]+)?/i,url_text:"https://player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vimeo"},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"https://www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"dailymotion"},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"yahoo"},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"https://rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"rutube"},{test_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&\/]+)\/?(?:[^_.&]+)?/,url_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&\/]+)\/?(?:[^_.&]+)?/g,url_text:"https://play.vidyard.com/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vidyard"}],e.VIDEO_EMBED_REGEX=/^\W*((<iframe(.|\n)*>(\s|\n)*<\/iframe>)|(<embed(.|\n)*>))\W*$/i,e.PLUGINS.video=function(t){var i,o,r,s,n,a,d=t.$,l="https://i.froala.com/upload",f=2,v=3,p=4,u=5,c=6,h={};function g(){var e=t.popups.get("video.insert");e.find(".fr-video-by-url-layer input").val("").trigger("change");var i=e.find(".fr-video-embed-layer textarea");i.val("").trigger("change"),(i=e.find(".fr-video-upload-layer input")).val("").trigger("change")}function m(){var e=t.popups.get("video.edit");if(e||(e=function(){var e="";if(0<t.opts.videoEditButtons.length){t.opts.videoResponsive&&(-1<t.opts.videoEditButtons.indexOf("videoSize")&&t.opts.videoEditButtons.splice(t.opts.videoEditButtons.indexOf("videoSize"),1),-1<t.opts.videoEditButtons.indexOf("videoDisplay")&&t.opts.videoEditButtons.splice(t.opts.videoEditButtons.indexOf("videoDisplay"),1),-1<t.opts.videoEditButtons.indexOf("videoAlign")&&t.opts.videoEditButtons.splice(t.opts.videoEditButtons.indexOf("videoAlign"),1));var i={buttons:e+='<div class="fr-buttons"> \n      '.concat(t.button.buildList(t.opts.videoEditButtons)," \n      </div>")},o=t.popups.create("video.edit",i);return t.events.$on(t.$wp,"scroll.video-edit",function(){s&&t.popups.isVisible("video.edit")&&(t.events.disableBlur(),x(s))}),o}return!1}()),e){t.popups.setContainer("video.edit",t.$sc),t.popups.refresh("video.edit");var i=s.find("iframe, embed, video"),o=i.offset().left+i.outerWidth()/2,r=i.offset().top+i.outerHeight();t.popups.show("video.edit",o,r,i.outerHeight(),!0)}}function b(e){if(e)return t.popups.onRefresh("video.insert",g),t.popups.onHide("video.insert",j),!0;var i="";t.opts.videoUpload||-1===t.opts.videoInsertButtons.indexOf("videoUpload")||t.opts.videoInsertButtons.splice(t.opts.videoInsertButtons.indexOf("videoUpload"),1);var o=t.button.buildList(t.opts.videoInsertButtons);""!==o&&(i='<div class="fr-buttons">'+o+"</div>");var r,s="",n=t.opts.videoInsertButtons.indexOf("videoUpload"),a=t.opts.videoInsertButtons.indexOf("videoByURL"),l=t.opts.videoInsertButtons.indexOf("videoEmbed");0<=a&&(r=" fr-active",(n<a&&0<=n||l<a&&0<=l)&&(r=""),s='<div class="fr-video-by-url-layer fr-layer'+r+'" id="fr-video-by-url-layer-'+t.id+'"><div class="fr-input-line"><input id="fr-video-by-url-layer-text-'+t.id+'" type="text" placeholder="'+t.language.translate("Paste in a video URL")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertByURL" tabIndex="2" role="button">'+t.language.translate("Insert")+"</button></div></div>");var f="";0<=l&&(r=" fr-active",(n<l&&0<=n||a<l&&0<=a)&&(r=""),f='<div class="fr-video-embed-layer fr-layer'+r+'" id="fr-video-embed-layer-'+t.id+'"><div class="fr-input-line"><textarea id="fr-video-embed-layer-text'+t.id+'" type="text" placeholder="'+t.language.translate("Embedded Code")+'" tabIndex="1" aria-required="true" rows="5"></textarea></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertEmbed" tabIndex="2" role="button">'+t.language.translate("Insert")+"</button></div></div>");var v="";0<=n&&(r=" fr-active",(l<n&&0<=l||a<n&&0<=a)&&(r=""),v='<div class="fr-video-upload-layer fr-layer'+r+'" id="fr-video-upload-layer-'+t.id+'"><strong>'+t.language.translate("Drop video")+"</strong><br>("+t.language.translate("or click")+')<div class="fr-form"><input type="file" accept="video/'+t.opts.videoAllowedTypes.join(", video/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-video-upload-layer-'+t.id+'" role="button"></div></div>');var p={buttons:i,by_url_layer:s,embed_layer:f,upload_layer:v,progress_bar:'<div class="fr-video-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="videoDismissError" tabIndex="2" role="button">OK</button></div></div>'},u=t.popups.create("video.insert",p);return function(e){t.events.$on(e,"dragover dragenter",".fr-video-upload-layer",function(){return d(this).addClass("fr-drop"),!1},!0),t.events.$on(e,"dragleave dragend",".fr-video-upload-layer",function(){return d(this).removeClass("fr-drop"),!1},!0),t.events.$on(e,"drop",".fr-video-upload-layer",function(i){i.preventDefault(),i.stopPropagation(),d(this).removeClass("fr-drop");var o=i.originalEvent.dataTransfer;if(o&&o.files){var r=e.data("instance")||t;r.events.disableBlur(),r.video.upload(o.files),r.events.enableBlur()}},!0),t.helpers.isIOS()&&t.events.$on(e,"touchstart",'.fr-video-upload-layer input[type="file"]',function(){d(this).trigger("click")},!0),t.events.$on(e,"change",'.fr-video-upload-layer input[type="file"]',function(){if(this.files){var i=e.data("instance")||t;i.events.disableBlur(),e.find("input:focus").blur(),i.events.enableBlur(),i.video.upload(this.files)}d(this).val("")},!0)}(u),u}function y(e){t.events.focus(!0),t.selection.restore();var i=!1;s&&(W(),i=!0),t.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video fr-deletable">'+e+"</span>",!1,t.opts.videoSplitHTML),t.popups.hide("video.insert");var o=t.$el.find(".fr-jiv");o.removeClass("fr-jiv"),o.toggleClass("fr-rv",t.opts.videoResponsive),q(o,t.opts.videoDefaultDisplay,t.opts.videoDefaultAlign),o.toggleClass("fr-draggable",t.opts.videoMove),t.events.trigger(i?"video.replaced":"video.inserted",[o])}function w(){var e=d(this);t.popups.hide("video.insert"),e.removeClass("fr-uploading"),e.parent().next().is("br")&&e.parent().next().remove(),x(e.parent()),t.events.trigger("video.loaded",[e.parent()])}function E(e,i,o,r,s){t.edit.off(),S("Loading video"),i&&(e=t.helpers.sanitizeURL(e));C("Loading video"),function(){var i,n;if(r){t.undo.canDo()||r.find("video").hasClass("fr-uploading")||t.undo.saveStep();var a=r.find("video").data("fr-old-src"),l=r.data("fr-replaced");r.data("fr-replaced",!1),t.$wp?((i=r.clone(!0)).find("video").removeData("fr-old-src").removeClass("fr-uploading"),i.find("video").off("canplay"),a&&r.find("video").attr("src",a),r.replaceWith(i)):i=r;for(var f=i.find("video").get(0).attributes,v=0;v<f.length;v++){var p=f[v];0===p.nodeName.indexOf("data-")&&i.find("video").removeAttr(p.nodeName)}if(void 0!==o)for(n in o)o.hasOwnProperty(n)&&"link"!=n&&i.find("video").attr("data-"+n,o[n]);i.find("video").on("canplay",w),i.find("video").attr("src",e),t.edit.on(),L(),t.undo.saveStep(),t.$el.blur(),t.events.trigger(l?"video.replaced":"video.inserted",[i,s])}else i=function(e,i,o){var r,s="";if(i&&void 0!==i)for(r in i)i.hasOwnProperty(r)&&"link"!=r&&(s+=" data-"+r+'="'+i[r]+'"');var n=t.opts.videoDefaultWidth;n&&"auto"!=n&&(n+="px");var a=d(document.createElement("span")).attr("contenteditable","false").attr("draggable","true").attr("class","fr-video fr-dv"+t.opts.videoDefaultDisplay[0]+("center"!=t.opts.videoDefaultAlign?" fr-fv"+t.opts.videoDefaultAlign[0]:"")).html('<video src="'+e+'" '+s+(n?' style="width: '+n+';" ':"")+" controls>"+t.language.translate("Your browser does not support HTML5 video.")+"</video>");a.toggleClass("fr-draggable",t.opts.videoMove),t.edit.on(),t.events.focus(!0),t.selection.restore(),t.undo.saveStep(),t.opts.videoSplitHTML?t.markers.split():t.markers.insert(),t.html.wrap();var l=t.$el.find(".fr-marker");return t.node.isLastSibling(l)&&l.parent().hasClass("fr-deletable")&&l.insertAfter(l.parent()),l.replaceWith(a),t.selection.clear(),a.find("video").get(0).readyState>a.find("video").get(0).HAVE_FUTURE_DATA||t.helpers.isIOS()?o.call(a.find("video").get(0)):a.find("video").on("canplaythrough load",o),a}(e,o,w),L(),t.undo.saveStep(),t.events.trigger("video.inserted",[i,s])}()}function C(e){var i=t.popups.get("video.insert");if(i||(i=b()),i.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),i.find(".fr-video-progress-bar-layer").addClass("fr-active"),i.find(".fr-buttons").hide(),s){var o=s.find("video");t.popups.setContainer("video.insert",t.$sc);var r=o.offset().left,n=o.offset().top+o.height();t.popups.show("video.insert",r,n,o.outerHeight())}void 0===e&&S(t.language.translate("Uploading"),0)}function _(e){var i=t.popups.get("video.insert");if(i&&(i.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),i.find(".fr-video-progress-bar-layer").removeClass("fr-active"),i.find(".fr-buttons").show(),e||t.$el.find("video.fr-error").length)){if(t.events.focus(),t.$el.find("video.fr-error").length&&(t.$el.find("video.fr-error").parent().remove(),t.undo.saveStep(),t.undo.run(),t.undo.dropRedo()),!t.$wp&&s){var o=s;T(!0),t.selection.setAfter(o.find("video").get(0)),t.selection.restore()}t.popups.hide("video.insert")}}function S(e,i){var o=t.popups.get("video.insert");if(o){var r=o.find(".fr-video-progress-bar-layer");r.find("h3").text(e+(i?" "+i+"%":"")),r.removeClass("fr-error"),i?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width",i+"%")):r.find("div").addClass("fr-indeterminate")}}function A(e){C();var i=t.popups.get("video.insert").find(".fr-video-progress-bar-layer");i.addClass("fr-error");var o=i.find("h3");o.text(e),t.events.disableBlur(),o.focus()}function x(e){z.call(e.get(0))}function R(){K(p,this.response||this.responseText||this.responseXML)}function D(e){if(e.lengthComputable){var i=e.loaded/e.total*100|0;S(t.language.translate("Uploading"),i)}}function U(){t.edit.on(),_(!0)}function B(e){if(!t.core.sameInstance(r))return!0;e.preventDefault(),e.stopPropagation();var s=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),n=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!s||!n)return!1;if("mousedown"==e.type){var a=t.$oel.get(0).ownerDocument,l=a.defaultView||a.parentWindow,f=!1;try{f=l.location!=l.parent.location&&!(l.$&&l.$.FE)}catch(e){}f&&l.frameElement&&(s+=t.helpers.getPX(d(l.frameElement).offset().left)+l.frameElement.clientLeft,n=e.clientY+t.helpers.getPX(d(l.frameElement).offset().top)+l.frameElement.clientTop)}t.undo.canDo()||t.undo.saveStep(),(o=d(this)).data("start-x",s),o.data("start-y",n),i.show(),t.popups.hideAll(),V()}function $(e){if(!t.core.sameInstance(r))return!0;if(o){e.preventDefault();var i=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),n=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!i||!n)return!1;var a=o.data("start-x"),d=o.data("start-y");o.data("start-x",i),o.data("start-y",n);var l=i-a,f=n-d,v=s.find("iframe, embed, video"),p=v.width(),u=v.height();(o.hasClass("fr-hnw")||o.hasClass("fr-hsw"))&&(l=0-l),(o.hasClass("fr-hnw")||o.hasClass("fr-hne"))&&(f=0-f),v.css("width",p+l),v.css("height",u+f),v.removeAttr("width"),v.removeAttr("height"),P()}}function I(e){if(!t.core.sameInstance(r))return!0;o&&s&&(e&&e.stopPropagation(),o=null,i.hide(),P(),m(),t.undo.saveStep())}function k(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function O(e,t,i,o){return e.pageX=t,e.pageY=t,B.call(this,e),e.pageX=e.pageX+i*Math.floor(Math.pow(1.1,o)),e.pageY=e.pageY+i*Math.floor(Math.pow(1.1,o)),$.call(this,e),I.call(this,e),++o}function L(){var e,i=Array.prototype.slice.call(t.el.querySelectorAll("video, .fr-video > *")),o=[];for(e=0;e<i.length;e++)o.push(i[e].getAttribute("src")),d(i[e]).toggleClass("fr-draggable",t.opts.videoMove),""===i[e].getAttribute("class")&&i[e].removeAttribute("class"),""===i[e].getAttribute("style")&&i[e].removeAttribute("style");if(n)for(e=0;e<n.length;e++)o.indexOf(n[e].getAttribute("src"))<0&&t.events.trigger("video.removed",[d(n[e])]);n=i}function P(){r||function(){var o;if(t.shared.$video_resizer?(r=t.shared.$video_resizer,i=t.shared.$vid_overlay,t.events.on("destroy",function(){d("body").first().append(r.removeClass("fr-active"))},!0)):(t.shared.$video_resizer=d(document.createElement("div")).attr("class","fr-video-resizer"),r=t.shared.$video_resizer,t.events.$on(r,"mousedown",function(e){e.stopPropagation()},!0),t.opts.videoResize&&(r.append(k("nw")+k("ne")+k("sw")+k("se")),t.shared.$vid_overlay=d(document.createElement("div")).attr("class","fr-video-overlay"),i=t.shared.$vid_overlay,o=r.get(0).ownerDocument,d(o).find("body").first().append(i))),t.events.on("shared.destroy",function(){r.html("").removeData().remove(),r=null,t.opts.videoResize&&(i.remove(),i=null)},!0),t.helpers.isMobile()||t.events.$on(d(t.o_win),"resize.video",function(){T(!0)}),t.opts.videoResize){o=r.get(0).ownerDocument,t.events.$on(r,t._mousedown,".fr-handler",B),t.events.$on(d(o),t._mousemove,$),t.events.$on(d(o.defaultView||o.parentWindow),t._mouseup,I),t.events.$on(i,"mouseleave",I);var n=1,a=null,l=0;t.events.on("keydown",function(i){if(s){var o=-1!=navigator.userAgent.indexOf("Mac OS X")?i.metaKey:i.ctrlKey,r=i.which;(r!==a||200<i.timeStamp-l)&&(n=1),(r==e.KEYCODE.EQUALS||t.browser.mozilla&&r==e.KEYCODE.FF_EQUALS)&&o&&!i.altKey?n=O.call(this,i,1,1,n):(r==e.KEYCODE.HYPHEN||t.browser.mozilla&&r==e.KEYCODE.FF_HYPHEN)&&o&&!i.altKey&&(n=O.call(this,i,2,-1,n)),a=r,l=i.timeStamp}}),t.events.on("keyup",function(){n=1})}}(),(t.$wp||t.$sc).append(r),r.data("instance",t);var o=s.find("iframe, embed, video"),n=0,a=0;t.opts.iframe&&(a=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),n=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"))),r.css("top",(t.opts.iframe?o.offset().top+a-1:o.offset().top-t.$wp.offset().top-1)+t.$wp.scrollTop()).css("left",(t.opts.iframe?o.offset().left+n-1:o.offset().left-t.$wp.offset().left-1)+t.$wp.scrollLeft()).css("width",o.get(0).getBoundingClientRect().width).css("height",o.get(0).getBoundingClientRect().height).addClass("fr-active")}function z(i){if(i&&"touchend"==i.type&&a)return!0;if(i&&t.edit.isDisabled())return i.stopPropagation(),i.preventDefault(),!1;if(t.edit.isDisabled())return!1;for(var o=0;o<e.INSTANCES.length;o++)e.INSTANCES[o]!=t&&e.INSTANCES[o].events.trigger("video.hideResizer");t.toolbar.disable(),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur()),t.$el.find(".fr-video.fr-active").removeClass("fr-active"),(s=d(this)).addClass("fr-active"),t.opts.iframe&&t.size.syncIframe(),J(),P(),m(),t.selection.clear(),t.button.bulkRefresh(),t.events.trigger("image.hideResizer")}function T(e){s&&(t.shared.vid_exit_flag||!0===e)&&(r.removeClass("fr-active"),t.toolbar.enable(),s.removeClass("fr-active"),s=null,V())}function M(){t.shared.vid_exit_flag=!0}function V(){t.shared.vid_exit_flag=!1}function Y(i){var o=i.originalEvent.dataTransfer;if(o&&o.files&&o.files.length){var r=o.files[0];if(r&&r.type&&-1!==r.type.indexOf("video")){if(!t.opts.videoUpload)return i.preventDefault(),i.stopPropagation(),!1;t.markers.remove(),t.markers.insertAtPoint(i.originalEvent),t.$el.find(".fr-marker").replaceWith(e.MARKERS),t.popups.hideAll();var s=t.popups.get("video.insert");return s||(s=b()),t.popups.setContainer("video.insert",t.$sc),t.popups.show("video.insert",i.originalEvent.pageX,i.originalEvent.pageY),C(),0<=t.opts.videoAllowedTypes.indexOf(r.type.replace(/video\//g,""))?N(o.files):K(c),i.preventDefault(),i.stopPropagation(),!1}}}function N(e){if(void 0!==e&&0<e.length){if(!1===t.events.trigger("video.beforeUpload",[e]))return!1;var i,o=e[0];if((null===t.opts.videoUploadURL||t.opts.videoUploadURL==l)&&!t.opts.videoUploadToS3)return function(e){s&&s.find("iframe")&&s.find("iframe").length&&W();var t=new FileReader;t.onload=function(){t.result;for(var i=atob(t.result.split(",")[1]),o=[],r=0;r<i.length;r++)o.push(i.charCodeAt(r));E(window.URL.createObjectURL(new Blob([new Uint8Array(o)],{type:e.type})),!1,null,s)},C(),t.readAsDataURL(e)}(o),!1;if(o.size>t.opts.videoMaxSize)return K(u),!1;if(t.opts.videoAllowedTypes.indexOf(o.type.replace(/video\//g,""))<0)return K(c),!1;if(t.drag_support.formdata&&(i=t.drag_support.formdata?new FormData:null),i){var r;if(!1!==t.opts.videoUploadToS3)for(r in i.append("key",t.opts.videoUploadToS3.keyStart+(new Date).getTime()+"-"+(o.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",o.type),t.opts.videoUploadToS3.params)t.opts.videoUploadToS3.params.hasOwnProperty(r)&&i.append(r,t.opts.videoUploadToS3.params[r]);for(r in t.opts.videoUploadParams)t.opts.videoUploadParams.hasOwnProperty(r)&&i.append(r,t.opts.videoUploadParams[r]);i.append(t.opts.videoUploadParam,o);var n=t.opts.videoUploadURL;t.opts.videoUploadToS3&&(n=t.opts.videoUploadToS3.uploadURL?t.opts.videoUploadToS3.uploadURL:"https://"+t.opts.videoUploadToS3.region+".amazonaws.com/"+t.opts.videoUploadToS3.bucket);var a=t.core.getXHR(n,t.opts.videoUploadMethod);a.onload=function(){(function(e){S("Loading video");var i=this.status,o=this.response,r=this.responseXML,s=this.responseText;try{if(t.opts.videoUploadToS3)if(201==i){var n=function(e){try{var i=d(e).find("Location").text(),o=d(e).find("Key").text();return!1===t.events.trigger("video.uploadedToS3",[i,o,e],!0)?(t.edit.on(),!1):i}catch(t){return K(p,e),!1}}(r);n&&E(n,!1,[],e,o||r)}else K(p,o||r);else if(200<=i&&i<300){var a=function(e){try{if(!1===t.events.trigger("video.uploaded",[e],!0))return t.edit.on(),!1;var i=JSON.parse(e);return i.link?i:(K(f,e),!1)}catch(t){return K(p,e),!1}}(s);a&&E(a.link,!1,a,e,o||s)}else K(v,o||s)}catch(e){K(p,o||s)}}).call(a,s)},a.onerror=R,a.upload.onprogress=D,a.onabort=U,C(),t.events.disableBlur(),t.edit.off(),t.events.enableBlur();var h=t.popups.get("video.insert");h&&d(h.off("abortUpload")).on("abortUpload",function(){4!=a.readyState&&a.abort()}),a.send(i)}}}function K(e,i){t.edit.on(),s&&s.find("video").addClass("fr-error"),A(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("video.error",[{code:e,message:h[e]},i])}function X(){if(s){var e=t.popups.get("video.size"),i=s.find("iframe, embed, video");e.find('input[name="width"]').val(i.get(0).style.width||i.attr("width")).trigger("change"),e.find('input[name="height"]').val(i.get(0).style.height||i.attr("height")).trigger("change")}}function H(e){if(e)return t.popups.onRefresh("video.size",X),!0;var i={buttons:'<div class="fr-buttons fr-tabs">'+t.button.buildList(t.opts.videoSizeButtons)+"</div>",size_layer:'<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-'+t.id+'"><div class="fr-video-group"><div class="fr-input-line"><input id="fr-video-size-layer-width-'+t.id+'" type="text" name="width" placeholder="'+t.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-video-size-layer-height-'+t.id+'" type="text" name="height" placeholder="'+t.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoSetSize" tabIndex="2" role="button">'+t.language.translate("Update")+"</button></div></div>"},o=t.popups.create("video.size",i);return t.events.$on(t.$wp,"scroll",function(){s&&t.popups.isVisible("video.size")&&(t.events.disableBlur(),x(s))}),o}function G(e){if(void 0===e&&(e=s),e){if(e.hasClass("fr-fvl"))return"left";if(e.hasClass("fr-fvr"))return"right";if(e.hasClass("fr-dvb")||e.hasClass("fr-dvi"))return"center";if("block"==e.css("display")){if("left"==e.css("text-algin"))return"left";if("right"==e.css("text-align"))return"right"}else{if("left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function F(e){void 0===e&&(e=s);var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function W(){if(s&&!1!==t.events.trigger("video.beforeRemove",[s])){var e=s;t.popups.hideAll(),T(!0),t.selection.setBefore(e.get(0))||t.selection.setAfter(e.get(0)),e.remove(),t.selection.restore(),t.html.fillEmptyBlocks()}}function j(){_()}function q(e,i,o){!t.opts.htmlUntouched&&t.opts.useClasses?(e.removeClass("fr-fvl fr-fvr fr-dvb fr-dvi"),e.addClass("fr-fv"+o[0]+" fr-dv"+i[0])):"inline"==i?(e.css({display:"inline-block"}),"center"==o?e.css({float:"none"}):"left"==o?e.css({float:"left"}):e.css({float:"right"})):(e.css({display:"block",clear:"both"}),"left"==o?e.css({textAlign:"left"}):"right"==o?e.css({textAlign:"right"}):e.css({textAlign:"center"}))}function Z(){var i=t.$el.find("video").filter(function(){return 0===d(this).parents("span.fr-video").length});if(0!=i.length){i.wrap(d(document.createElement("span")).attr("class","fr-video fr-deletable").attr("contenteditable","false")),t.$el.find("embed, iframe").filter(function(){if(t.browser.safari&&this.getAttribute("src")&&this.setAttribute("src",this.src),0<d(this).parents("span.fr-video").length)return!1;for(var i=d(this).attr("src"),o=0;o<e.VIDEO_PROVIDERS.length;o++){var r=e.VIDEO_PROVIDERS[o];if(r.test_regex.test(i)&&new RegExp(t.opts.videoAllowedProviders.join("|")).test(r.provider))return!0}return!1}).map(function(){return 0===d(this).parents("object").length?this:d(this).parents("object").get(0)}).wrap(d(document.createElement("span")).attr("class","fr-video").attr("contenteditable","false"));for(var o,r,s,n,a=t.$el.find("span.fr-video, video"),l=0;l<a.length;l++){var f=d(a[l]);!t.opts.htmlUntouched&&t.opts.useClasses?((n=f).hasClass("fr-dvi")||n.hasClass("fr-dvb")||(n.addClass("fr-fv"+G(n)[0]),n.addClass("fr-dv"+F(n)[0])),t.opts.videoTextNear||f.removeClass("fr-dvi").addClass("fr-dvb")):t.opts.htmlUntouched||t.opts.useClasses||(r=(o=f).hasClass("fr-dvb")?"block":o.hasClass("fr-dvi")?"inline":null,s=o.hasClass("fr-fvl")?"left":o.hasClass("fr-fvr")?"right":G(o),q(o,r,s),o.removeClass("fr-dvb fr-dvi fr-fvr fr-fvl"))}a.toggleClass("fr-draggable",t.opts.videoMove)}}function J(){if(s){t.selection.clear();var e=t.doc.createRange();e.selectNode(s.get(0)),t.selection.get().addRange(e)}}return h[1]="Video cannot be loaded from the passed link.",h[f]="No link in upload response.",h[v]="Error during file upload.",h[p]="Parsing response failed.",h[u]="File is too large.",h[c]="Video file type is invalid.",h[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",t.shared.vid_exit_flag=!1,{_init:function(){t.opts.videoResponsive&&(t.opts.videoResize=!1),t.events.on("drop",Y,!0),t.events.on("mousedown window.mousedown",M),t.events.on("window.touchmove",V),t.events.on("mouseup window.mouseup",T),t.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&T()}),t.events.on("video.hideResizer commands.undo commands.redo element.dropped",function(){T(!0)}),t.helpers.isMobile()&&(t.events.$on(t.$el,"touchstart","span.fr-video",function(){a=!1}),t.events.$on(t.$el,"touchmove",function(){a=!0})),t.events.on("html.set",Z),Z(),t.events.$on(t.$el,"mousedown","span.fr-video",function(e){e.stopPropagation(),(t.browser.msie||t.browser.edge)&&(e.target.dragDrop(),z.call(this,e))}),t.events.$on(t.$el,"click touchend","span.fr-video",function(e){if("false"==d(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;z.call(this,e)}),t.events.on("keydown",function(i){var o=i.which;return!s||o!=e.KEYCODE.BACKSPACE&&o!=e.KEYCODE.DELETE?s&&o==e.KEYCODE.ESC?(T(!0),i.preventDefault(),!1):s&&o!=e.KEYCODE.F10&&!t.keys.isBrowserAction(i)?(i.preventDefault(),!1):void 0:(i.preventDefault(),W(),t.undo.saveStep(),!1)},!0),t.events.on("toolbar.esc",function(){if(s)return t.events.disableBlur(),t.events.focus(),!1},!0),t.events.on("toolbar.focusEditor",function(){if(s)return!1},!0),t.events.on("keydown",function(){t.$el.find("span.fr-video:empty").remove()}),t.$wp&&(L(),t.events.on("contentChanged",L)),b(!0),H(!0)},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertVideo"]'),i=t.popups.get("video.insert");if(i||(i=b()),_(),!i.hasClass("fr-active"))if(t.popups.refresh("video.insert"),t.popups.setContainer("video.insert",t.$tb),e.isVisible()){var o=t.button.getPosition(e),r=o.left,s=o.top;t.popups.show("video.insert",r,s,e.outerHeight())}else t.position.forSelection(i),t.popups.show("video.insert")},showLayer:function(e){var i,o,r=t.popups.get("video.insert");if(!s&&!t.opts.toolbarInline){var n=t.$tb.find('.fr-command[data-cmd="insertVideo"]');i=n.offset().left,o=n.offset().top+(t.opts.toolbarBottom?10:n.outerHeight()-10)}t.opts.toolbarInline&&(o=r.offset().top-t.helpers.getPX(r.css("margin-top")),r.hasClass("fr-above")&&(o+=r.outerHeight())),r.find(".fr-layer").removeClass("fr-active"),r.find(".fr-"+e+"-layer").addClass("fr-active"),t.popups.show("video.insert",i,o,0),t.accessibility.focusPopup(r)},refreshByURLButton:function(e){var i=t.popups.get("video.insert");i&&i.find(".fr-video-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshEmbedButton:function(e){var i=t.popups.get("video.insert");i&&i.find(".fr-video-embed-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshUploadButton:function(e){var i=t.popups.get("video.insert");i&&i.find(".fr-video-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:N,insertByURL:function(i){void 0===i&&(i=(t.popups.get("video.insert").find('.fr-video-by-url-layer input[type="text"]').val()||"").trim());var o=null;if(/^http/.test(i)||(i="https://"+i),t.helpers.isURL(i))for(var r=0;r<e.VIDEO_PROVIDERS.length;r++){var s=e.VIDEO_PROVIDERS[r];if(s.test_regex.test(i)&&new RegExp(t.opts.videoAllowedProviders.join("|")).test(s.provider)){o=i.replace(s.url_regex,s.url_text),o=s.html.replace(/\{url\}/,o);break}}o?y(o):(A(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("video.linkError",[i]))},insertEmbed:function(i){void 0===i&&(i=t.popups.get("video.insert").find(".fr-video-embed-layer textarea").val()||""),0!==i.length&&e.VIDEO_EMBED_REGEX.test(i)?y(i):(A(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("video.codeError",[i]))},insert:y,align:function(e){s.removeClass("fr-fvr fr-fvl"),!t.opts.htmlUntouched&&t.opts.useClasses?"left"==e?s.addClass("fr-fvl"):"right"==e&&s.addClass("fr-fvr"):q(s,F(),e),J(),P(),m(),t.selection.clear()},refreshAlign:function(e){if(!s)return!1;e.find(">*").first().replaceWith(t.icon.create("video-align-"+G()))},refreshAlignOnShow:function(e,t){s&&t.find('.fr-command[data-param1="'+G()+'"]').addClass("fr-active").attr("aria-selected",!0)},display:function(e){s.removeClass("fr-dvi fr-dvb"),!t.opts.htmlUntouched&&t.opts.useClasses?"inline"==e?s.addClass("fr-dvi"):"block"==e&&s.addClass("fr-dvb"):q(s,e,G()),J(),P(),m(),t.selection.clear()},refreshDisplayOnShow:function(e,t){s&&t.find('.fr-command[data-param1="'+F()+'"]').addClass("fr-active").attr("aria-selected",!0)},remove:W,hideProgressBar:_,showSizePopup:function(){var e=t.popups.get("video.size");e||(e=H()),_(),t.popups.refresh("video.size"),t.popups.setContainer("video.size",t.$sc);var i=s.find("iframe, embed, video"),o=i.offset().left+i.outerWidth()/2,r=i.offset().top+i.height();t.popups.show("video.size",o,r,i.height(),!0)},replace:function(){var e=t.popups.get("video.insert");e||(e=b()),t.popups.isVisible("video.insert")||(_(),t.popups.refresh("video.insert"),t.popups.setContainer("video.insert",t.$sc));var i=s.offset().left+s.outerWidth()/2,o=s.offset().top+s.height();t.popups.show("video.insert",i,o,s.outerHeight(),!0)},back:function(){s?(t.events.disableBlur(),s[0].click()):(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("video.insert"),t.toolbar.showInline())},setSize:function(e,i){if(s){var o=t.popups.get("video.size"),r=s.find("iframe, embed, video");r.css("width",e||o.find('input[name="width"]').val()),r.css("height",i||o.find('input[name="height"]').val()),r.get(0).style.width&&r.removeAttr("width"),r.get(0).style.height&&r.removeAttr("height"),o.find("input:focus").blur(),setTimeout(function(){s.trigger("click")},t.helpers.isAndroid()?50:0)}},get:function(){return s},showProgressBar:C}},e.RegisterCommand("insertVideo",{title:"Insert Video",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("video.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("video.insert")):this.video.showInsertPopup()},plugin:"video"}),e.DefineIcon("insertVideo",{NAME:"video-camera",FA5NAME:"camera",SVG_KEY:"insertVideo"}),e.DefineIcon("videoByURL",{NAME:"link",SVG_KEY:"insertLink"}),e.RegisterCommand("videoByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-by-url")},refresh:function(e){this.video.refreshByURLButton(e)}}),e.DefineIcon("videoEmbed",{NAME:"code",SVG_KEY:"codeView"}),e.RegisterCommand("videoEmbed",{title:"Embedded Code",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-embed")},refresh:function(e){this.video.refreshEmbedButton(e)}}),e.DefineIcon("videoUpload",{NAME:"upload",SVG_KEY:"upload"}),e.RegisterCommand("videoUpload",{title:"Upload Video",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-upload")},refresh:function(e){this.video.refreshUploadButton(e)}}),e.RegisterCommand("videoInsertByURL",{undo:!0,focus:!0,callback:function(){this.video.insertByURL()}}),e.RegisterCommand("videoInsertEmbed",{undo:!0,focus:!0,callback:function(){this.video.insertEmbed()}}),e.DefineIcon("videoDisplay",{NAME:"star",SVG_KEY:"star"}),e.RegisterCommand("videoDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.video.display(t)},refresh:function(e){this.opts.videoTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.video.refreshDisplayOnShow(e,t)}}),e.DefineIcon("video-align",{NAME:"align-left",SVG_KEY:"align Left"}),e.DefineIcon("video-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("video-align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),e.DefineIcon("video-align-center",{NAME:"align-justify",SVG_KEY:"alignJustify"}),e.DefineIcon("videoAlign",{NAME:"align-center",SVG_KEY:"alignCenter"}),e.RegisterCommand("videoAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',i=e.COMMANDS.videoAlign.options;for(var o in i)i.hasOwnProperty(o)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="videoAlign" data-param1="'+o+'" title="'+this.language.translate(i[o])+'">'+this.icon.create("video-align-"+o)+'<span class="fr-sr-only">'+this.language.translate(i[o])+"</span></a></li>");return t+"</ul>"},callback:function(e,t){this.video.align(t)},refresh:function(e){this.video.refreshAlign(e)},refreshOnShow:function(e,t){this.video.refreshAlignOnShow(e,t)}}),e.DefineIcon("videoReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"}),e.RegisterCommand("videoReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.video.replace()}}),e.DefineIcon("videoRemove",{NAME:"trash",SVG_KEY:"remove"}),e.RegisterCommand("videoRemove",{title:"Remove",callback:function(){this.video.remove()}}),e.DefineIcon("videoSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"}),e.RegisterCommand("videoSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.video.showSizePopup()}}),e.DefineIcon("videoBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("videoBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.video.back()},refresh:function(e){this.video.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.RegisterCommand("videoDismissError",{title:"OK",undo:!1,callback:function(){this.video.hideProgressBar(!0)}}),e.RegisterCommand("videoSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.video.setSize()}})});