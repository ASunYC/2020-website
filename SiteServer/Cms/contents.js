var $api=new apiUtils.Api(apiUrl+"/pages/cms/contents");Object.defineProperty(Object.prototype,"getProp",{value:function(t){var e;for(e in this)if(e.toLowerCase()==t.toLowerCase())return this[e]}});var data={siteId:parseInt(pageUtils.getQueryStringByName("siteId")),channelId:parseInt(pageUtils.getQueryStringByName("channelId")),pageLoad:!1,pageAlert:null,pageType:null,page:1,pageContents:null,count:null,pages:null,permissions:null,columns:null,isAllContents:!1,pageOptions:null,isAllChecked:!1},methods={btnAddClick:function(t){t.stopPropagation(),location.href="pageContentAdd.aspx?siteId="+this.siteId+"&channelId="+this.channelId+"&returnUrl="+encodeURIComponent(location.href)},getPageContentAddUrl:function(t){return"pageContentAdd.aspx?siteId="+this.siteId+"&channelId="+t.channelId+"&id="+t.id+"&returnUrl="+encodeURIComponent(location.href)},btnCreateClick:function(t){t.stopPropagation();var e=this;this.pageAlert=null,this.isContentChecked&&(pageUtils.loading(!0),$api.postAt("actions/create",{siteId:e.siteId,channelContentIds:this.channelContentIds},function(t,n){!t&&n&&n.value&&(pageUtils.loading(!1),e.pageAlert={type:"success",html:"内容已添加至生成列队！<a href='createStatus.cshtml?siteId="+e.siteId+"'>生成进度查看</a>"})}))},btnLayerClick:function(t,e){e.stopPropagation(),this.pageAlert=null;var n="contentsLayer"+t.name+".cshtml?siteId="+this.siteId;if(t.channelId?n+="&channelId="+t.channelId:n+="&channelId="+this.channelId,t.contentId&&(n+="&contentId="+t.contentId),t.withContents){if(!this.isContentChecked)return;n+="&channelContentIds="+this.channelContentIdsString}t.withOptionalContents&&this.isContentChecked&&(n+="&channelContentIds="+this.channelContentIdsString),n+="&returnUrl="+encodeURIComponent(location.href),pageUtils.openLayer({title:t.title,url:n,full:t.full,width:t.width?t.width:700,height:t.height?t.height:500})},btnContentViewClick:function(t,e){e.stopPropagation(),pageUtils.openLayer({title:"查看内容",url:"contentsLayerView.cshtml?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+t,full:!0})},btnContentStateClick:function(t,e){e.stopPropagation(),pageUtils.openLayer({title:"查看审核状态",url:"contentsLayerState.cshtml?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+t,full:!0})},toggleChecked:function(t){t.isSelected=!t.isSelected,t.isSelected||(this.isAllChecked=!1)},selectAll:function(){this.isAllChecked=!this.isAllChecked;for(var t=0;t<this.pageContents.length;t++)this.pageContents[t].isSelected=this.isAllChecked},loadFirstPage:function(){1!==this.page&&this.loadContents(1)},loadPrevPage:function(){this.page-1<=0||this.loadContents(this.page-1)},loadNextPage:function(){this.page+1>this.pages||this.loadContents(this.page+1)},loadLastPage:function(){this.page+1>this.pages||this.loadContents(this.pages)},onPageSelect:function(t){this.loadContents(t)},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},getPluginMenuUrl:function(t){return t.href+"&returnUrl="+encodeURIComponent(location.href)},btnPluginMenuClick:function(t,e){e.stopPropagation(),"_layer"===t.target&&pageUtils.openLayer({title:t.text,url:this.getPluginMenuUrl(t),full:!0})},loadContents:function(t){var e=this;e.pageLoad&&pageUtils.loading(!0),$api.get({siteId:e.siteId,channelId:e.channelId,page:t},function(n,i){if(!n&&i&&i.value){for(var s=[],o=0;o<i.value.length;o++){var a=_.assign({},i.value[o],{isSelected:!1});s.push(a)}e.pageContents=s,e.count=i.count,e.pages=i.pages,e.permissions=i.permissions,e.columns=i.columns,e.isAllContents=i.isAllContents,e.page=t,e.pageOptions=[];for(o=1;o<=e.pages;o++)e.pageOptions.push(o);e.pageLoad?(pageUtils.loading(!1),e.scrollToTop()):e.pageLoad=!0}})}};Vue.component("multiselect",window.VueMultiselect.default);var $vue=new Vue({el:"#main",data:data,methods:methods,computed:{isContentChecked:function(){if(this.pageContents)for(var t=0;t<this.pageContents.length;t++)if(this.pageContents[t].isSelected)return!0;return!1},channelContentIds:function(){var t=[];if(this.pageContents)for(var e=0;e<this.pageContents.length;e++)this.pageContents[e].isSelected&&t.push({channelId:this.pageContents[e].channelId,id:this.pageContents[e].id});return t},channelContentIdsString:function(){var t=[];if(this.pageContents)for(var e=0;e<this.pageContents.length;e++)this.pageContents[e].isSelected&&t.push(this.pageContents[e].channelId+"_"+this.pageContents[e].id);return t.join(",")}},created:function(){this.loadContents(1)}});