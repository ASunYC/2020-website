var $api=new apiUtils.Api(apiUrl+"/pages/settings/admin"),data={pageLoad:!1,pageAlert:null,drawer:!1,items:null,count:null,roles:null,isSuperAdmin:null,adminId:null,formInline:{role:"",order:"",lastActivityDate:0,keyword:"",currentPage:1,offset:0,limit:30},permissionInfo:{}},methods={apiGetConfig:function(){var i=this;$api.get(this.formInline,function(e,n){!e&&n&&n.value&&(i.items=n.value,i.count=n.count,i.roles=n.roles,i.isSuperAdmin=n.isSuperAdmin,i.adminId=n.adminId,i.pageLoad=!0)})},btnEditClick:function(i){location.href="adminProfile.cshtml?pageType=admin&userId="+i.id},btnPasswordClick:function(i){location.href="adminPassword.cshtml?pageType=admin&userId="+i.id},btnPermissionsClick:function(i){var e=this;pageUtils.loading(!0),$api.getAt("permissions/"+i.id,null,function(n,t){if(pageUtils.loading(!1),!n&&t&&t.value){for(var l=[],a=0;a<t.roles.length;a++)l.push({key:t.roles[a],label:t.roles[a],disabled:!1});e.permissionInfo={adminId:i.id,allRoles:l,allSites:t.allSites,adminLevel:t.adminLevel,checkedSites:t.checkedSites,checkedRoles:t.checkedRoles,loading:!1},e.drawer=!0}})},btnPermissionSubmitClick:function(){var i=this;this.permissionInfo.loading=!0,$api.postAt("permissions/"+this.permissionInfo.adminId,{adminLevel:this.permissionInfo.adminLevel,checkedSites:this.permissionInfo.checkedSites,checkedRoles:this.permissionInfo.checkedRoles},function(e,n){if(!e&&n&&n.value){for(var t=0;t<i.items.length;t++){var l=i.items[t];l.id===i.permissionInfo.adminId&&(l.roles=n.roles)}i.drawer=!1}})},btnDeleteClick:function(i){var e=this;pageUtils.alertDelete({title:"删除管理员",text:"此操作将删除管理员 "+i.userName+"，确定吗？",callback:function(){pageUtils.loading(!0),$api.delete({id:i.id},function(n,t){pageUtils.loading(!1),!n&&t&&t.value&&e.items.splice(e.items.indexOf(i),1)})}})},btnLockClick:function(i){pageUtils.alertWarning({title:"锁定管理员",text:"此操作将锁定管理员 "+i.userName+"，确定吗？",callback:function(){pageUtils.loading(!0),$api.postAt("actions/lock",{id:i.id},function(e,n){pageUtils.loading(!1),!e&&n&&n.value&&(i.locked=!0)})}})},btnUnLockClick:function(i){pageUtils.alertWarning({title:"解锁管理员",text:"此操作将解锁管理员 "+i.userName+"，确定吗？",callback:function(){pageUtils.loading(!0),$api.postAt("actions/unLock",{id:i.id},function(e,n){pageUtils.loading(!1),!e&&n&&n.value&&(i.locked=!1)})}})},btnSearchClick(){var i=this;pageUtils.loading(!0),$api.get(this.formInline,function(e,n){pageUtils.loading(!1),!e&&n&&n.value&&(i.items=n.value,i.count=n.count)})},handleCurrentChange:function(i){this.formInline.currentValue=i,this.formInline.offset=this.formInline.limit*(i-1),this.btnSearchClick()}};new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiGetConfig()}});